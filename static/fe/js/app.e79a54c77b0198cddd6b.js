webpackJsonp([1],{"+U5m":function(t,e){},"/BnU":function(t,e){},"0mC3":function(t,e){},"1iMi":function(t,e){},"3q6I":function(t,e){},"4Ida":function(t,e){},"5t2J":function(t,e){},"6EHV":function(t,e){},"6qdl":function(t,e){},"83Ex":function(t,e){},"9VxE":function(t,e){},EBsE:function(t,e){},EgK5:function(t,e){},GxPi:function(t,e){},LoFE:function(t,e){},Mcfc:function(t,e){},NHnr:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={};n.d(i,"getUserInfo",function(){return Te});var a,s=n("7+uW"),r=n("zL8q"),o=n.n(r),c=n("OS1Z"),l=n.n(c),d=(n("pw1w"),n("Viya"),{render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app",align:"center"}},[e("div",{attrs:{id:"background"}}),this._v(" "),e("div",{attrs:{id:"conntainer",align:"left"}},[e("router-view")],1)])},staticRenderFns:[]}),u=n("VU/8")({name:"app"},d,!1,function(t){n("6qdl")},null,null).exports,m=n("/ocq"),p=n("Dd8w"),h=n.n(p),f=n("NYxO"),v="LOGOUT",g="UPDATE_AVATAR",k="UPDATE_INFO",_=n("//Fk"),b=n.n(_),y=!1,T=null,x=function(t,e){return new b.a(function(n,i){y=!0,setTimeout(function(){y&&(T=r.Loading.service({fullscreen:!0}))},1e3),void 0===(e=e||{}).headers&&(e.headers={"Content-type":"application/x-www-form-urlencoded; charset=UTF-8"}),e.credentials="include",window.fetch(t,e).then(function(t){if(y=!1,T&&T.close(),!t.ok)throw new Error;return t.json()}).then(function(t){10011===t.code?we.push({name:"Login"}):n(t)}).catch(function(t){i(t)})})},C=function(){return x("/index.php/user/logout")},$=function(){return x("/index.php/team/teamList")},w=function(t){return x("/index.php/task/deleteTaskList",{method:"POST",body:"taskListId="+encodeURIComponent(t)})},I=function(t,e){return x("/index.php/task/editTaskList",{method:"POST",body:"taskListId="+encodeURIComponent(t)+"&taskListName="+encodeURIComponent(e)})},D=function(t){return x("/index.php/task/archivedTaskList",{method:"POST",body:"taskListId="+encodeURIComponent(t)})},S=function(t,e,n){return x("/index.php/task/create",{method:"POST",body:"pid="+encodeURIComponent(t)+"&taskListId="+encodeURIComponent(void 0===n?null:n)+"&name="+encodeURIComponent(e)})},E=function(t){return x("/index.php/task/delete",{method:"POST",body:"taskId="+encodeURIComponent(t)})},U={name:"Login",data:function(){return{loginForm:{email:"",password:""},loginFormRules:{email:[{type:"email",required:!0,message:"请输入正确的邮箱地址",trigger:"blur"}],password:[{required:!0,min:6,message:"请输入正确的密码",trigger:"blur"}]},registerForm:{name:"",email:"",password:""},registerFormRules:{email:[{type:"email",required:!0,message:"请输入正确的邮箱地址",trigger:"blur"}],password:[{required:!0,min:6,message:"请输入正确的密码",trigger:"blur"}],name:[{required:!0,message:"名字不能为空",trigger:"blur"}]},isLogin:!0}},methods:h()({},Object(f.b)({update_login:"LOGIN"}),{login:function(){var t=this;this.$refs.loginForm.validate(function(e){if(e){var n=t.loginForm;(function(t,e){return x("/index.php/user/login",{method:"POST",body:"email="+encodeURIComponent(t)+"&password="+encodeURIComponent(e)})})(n.email,n.password).then(function(e){e.error?t.$message.error(e.error):(t.update_login(e.data),t.$message({message:"登录成功",type:"success"}),setTimeout(function(){return we.push({name:"Launchpad"})},1e3))})}})},register:function(){var t=this;this.$refs.registerForm.validate(function(e){if(e){var n=t.registerForm;(function(t,e,n){return x("/index.php/user/register",{method:"POST",body:"name="+encodeURIComponent(t)+"&email="+encodeURIComponent(e)+"&password="+encodeURIComponent(n)})})(n.name,n.email,n.password).then(function(e){e.error?t.$message.error(e.error):(t.update_login(e.data),t.$message({message:"注册成功",type:"success"}),setTimeout(function(){return we.push({name:"Launchpad"})},1e3))})}})}})},L={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"container",attrs:{align:"center"}},[n("h1",{attrs:{id:"title"}},[t._v("\n    Team Club\n  ")]),t._v(" "),n("transition",{attrs:{name:"el-zoom-in-center"}},[n("el-card",{directives:[{name:"show",rawName:"v-show",value:t.isLogin,expression:"isLogin"}],staticClass:"form-container"},[n("el-form",{ref:"loginForm",attrs:{rules:t.loginFormRules,model:t.loginForm}},[n("el-form-item",{attrs:{prop:"email"}},[n("el-input",{attrs:{placeholder:"登录邮箱"},model:{value:t.loginForm.email,callback:function(e){t.$set(t.loginForm,"email",e)},expression:"loginForm.email"}})],1),t._v(" "),n("el-form-item",{attrs:{prop:"password"}},[n("el-input",{attrs:{type:"password",placeholder:"密码"},model:{value:t.loginForm.password,callback:function(e){t.$set(t.loginForm,"password",e)},expression:"loginForm.password"}})],1),t._v(" "),n("el-form-item",[n("el-button",{staticClass:"form-button",attrs:{type:"primary"},on:{click:t.login}},[t._v("登录")])],1),t._v(" "),n("el-form-item",{staticClass:"register-container"},[n("span",{staticStyle:{color:"#2c3e50"}},[t._v("没有账号？")]),n("a",{attrs:{href:"#"},on:{click:function(e){t.isLogin=!1}}},[t._v("立即注册>")])])],1)],1)],1),t._v(" "),n("transition",{attrs:{name:"el-zoom-in-center"}},[n("el-card",{directives:[{name:"show",rawName:"v-show",value:!t.isLogin,expression:"!isLogin"}],staticClass:"form-container"},[n("el-form",{ref:"registerForm",attrs:{rules:t.registerFormRules,model:t.registerForm}},[n("el-form-item",{attrs:{prop:"name"}},[n("el-input",{attrs:{placeholder:"你的名字"},model:{value:t.registerForm.name,callback:function(e){t.$set(t.registerForm,"name",e)},expression:"registerForm.name"}})],1),t._v(" "),n("el-form-item",{attrs:{prop:"email"}},[n("el-input",{attrs:{placeholder:"邮箱"},model:{value:t.registerForm.email,callback:function(e){t.$set(t.registerForm,"email",e)},expression:"registerForm.email"}})],1),t._v(" "),n("el-form-item",{attrs:{prop:"password"}},[n("el-input",{attrs:{type:"password",placeholder:"密码（不少于6位）"},model:{value:t.registerForm.password,callback:function(e){t.$set(t.registerForm,"password",e)},expression:"registerForm.password"}})],1),t._v(" "),n("el-form-item",[n("el-button",{staticClass:"form-button",attrs:{type:"primary"},on:{click:t.register}},[t._v("注册")])],1),t._v(" "),n("el-form-item",{staticClass:"register-container"},[n("span",{staticStyle:{color:"#2c3e50"}},[t._v("已有账号？")]),n("a",{attrs:{href:"#"},on:{click:function(e){t.isLogin=!0}}},[t._v("去登录")])])],1)],1)],1)],1)},staticRenderFns:[]},R=n("VU/8")(U,L,!1,function(t){n("0mC3")},null,null).exports,O={name:"Launchpad",mounted:function(){var t=this;$().then(function(e){if(e.error)throw Error(e.error);t.teamList=e.data}).catch(function(){t.$message.error("获取团队列表失败!")})},data:function(){return{name:"Pencil",teamList:[],createForm:{name:""}}},computed:Object(f.c)(["user"]),methods:h()({},Object(f.b)({remove_info:v}),{logout:function(){var t=this;C().then(function(){t.remove_info(),we.push({name:"Login"})})},createTeam:function(){var t=this;this.$prompt("请输入新的团队名称","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/.+/,inputErrorMessage:"团队名称不能为空"}).then(function(e){var n=e.value;(function(t){return x("/index.php/team/createTeam",{method:"POST",body:"name="+encodeURIComponent(t)})})(n).then(function(e){if(e.error)throw Error("创建团队失败");t.teamList.push({tid:e.data,name:n,uid:t.user.uid})})}).catch(function(){t.$message.error("创建团队失败!")})}})},F={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{attrs:{align:"center"}},[n("header",[n("h2",{attrs:{id:"header-title"}},[t._v("TeamClub")]),t._v(" "),n("div",{attrs:{id:"userinfo"}},[n("small",[t._v("hi, "+t._s(t.user.name))]),t._v(" "),n("small",[n("a",{attrs:{href:"#"},on:{click:t.logout}},[t._v("退出")])])])]),t._v(" "),n("el-card",{attrs:{id:"team-list-container","body-style":{padding:"0px"}}},[t._l(t.teamList,function(e,i){return n("router-link",{key:i,staticClass:"team-item",attrs:{to:{name:"Team",params:{tid:e.tid}}}},[t._v("\n        "+t._s(e.name)+"\n      ")])}),t._v(" "),n("div",{staticClass:"team-item create-team-item",on:{click:t.createTeam}},[n("i",{staticClass:"el-icon-plus"}),t._v(" 新的团队\n      ")])],2)],1)])},staticRenderFns:[]},P=n("VU/8")(O,F,!1,function(t){n("eTKJ")},null,null).exports,j={name:"Team",created:function(){var t=this;$().then(function(e){if(e.error)throw Error(e.error);t.teamList=e.data}).catch(function(e){t.$message.error(e.message)}),this.getTeamMembers()},data:function(){return{teamList:[],members:[],showTeamMenu:!1,showUserMenu:!1}},computed:h()({},Object(f.c)(["user"]),{otherTeamList:function(){var t=this;return this.teamList.filter(function(e){return e.tid!==t.$route.params.tid},10)},currentTeam:function(){for(var t=this.teamList,e=0;e<t.length;e++){var n=t[e];if(n.tid===this.$route.params.tid)return n}return{tid:-1,name:"Loading"}},isTeamMember:function(){var t=this;return this.members.filter(function(e){return e.uid===t.user.uid}).length>0}}),methods:h()({},Object(f.b)({remove_info:v}),{updateTeamName:function(t){for(var e=this.teamList,n=0;n<e.length;n++){var i=e[n];if(i.tid===this.$route.params.tid){i.name=t,this.$set(this.teamList,n,i);break}}},logout:function(){var t=this;C().then(function(){t.remove_info(),we.push({name:"Login"})})},getTeamMembers:function(){var t=this;(function(t){return x("/index.php/team/getAcceptedMembers?tid="+encodeURIComponent(t))})(this.$route.params.tid).then(function(e){if(e.error)throw Error(e.error);t.members=e.data}).catch(function(e){t.$message.error(e.message)})},go:function(t){we.push(t)}}),watch:{$route:function(){this.showTeamMenu=!1,this.showUserMenu=!1}}},B={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("header",[n("el-popover",{attrs:{placement:"bottom",width:"100",trigger:"click"},model:{value:t.showTeamMenu,callback:function(e){t.showTeamMenu=e},expression:"showTeamMenu"}},[n("h3",{staticClass:"team-name",attrs:{slot:"reference"},slot:"reference"},[t._v(t._s(t.currentTeam.name)+" "),n("small",[n("i",{staticClass:"el-icon-caret-bottom"})])]),t._v(" "),n("ul",{staticClass:"team-menu"},[t.user.uid===t.currentTeam.uid?n("li",{staticClass:"clickable-item"},[n("router-link",{attrs:{to:{name:"Settings"}}},[t._v("团队账户")])],1):t._e(),t._v(" "),n("li",{staticStyle:{"padding-left":"8px",height:"20px"}},[n("small",{staticStyle:{color:"#aaa"}},[t._v("切换团队")]),t._v(" "),n("div",{staticClass:"part-line",staticStyle:{"margin-top":"-8px"}})]),t._v(" "),t._l(t.otherTeamList,function(e,i){return n("li",{key:i,staticClass:"clickable-item"},[n("router-link",{attrs:{to:{name:"Team",params:{tid:e.tid}}}},[t._v(t._s(e.name))])],1)}),t._v(" "),n("li",{staticClass:"part-line"}),t._v(" "),n("li",{staticClass:"clickable-item"},[n("router-link",{attrs:{to:{name:"Launchpad"}}},[n("small",[t._v("创建/管理团队")])])],1)],2)]),t._v(" "),n("ul",{staticClass:"nav"},[n("li",[n("router-link",{attrs:{to:{name:"Projects",params:{tid:t.$route.params.tid}}}},[t._v("项目")])],1),t._v(" "),n("li",[t.isTeamMember?n("router-link",{attrs:{to:{name:"Dynamic",params:{tid:t.$route.params.tid}}}},[t._v("动态")]):t._e()],1),t._v(" "),n("li",{staticClass:"dividing"}),t._v(" "),n("li",[n("router-link",{attrs:{to:{name:"Member",params:{tid:t.$route.params.tid}}}},[t._v("团队")])],1),t._v(" "),n("li",[n("router-link",{attrs:{to:{name:"UserInfo",params:{tid:t.$route.params.tid,uid:t.user.uid}}}},[t._v("我自己")])],1)]),t._v(" "),n("el-popover",{attrs:{placement:"bottom",width:"48",trigger:"click"},model:{value:t.showUserMenu,callback:function(e){t.showUserMenu=e},expression:"showUserMenu"}},[n("div",{staticClass:"account-info",attrs:{slot:"reference"},slot:"reference"},[n("img",{attrs:{id:"avatar",width:"24",height:"24",src:t.user.avatar,alt:"avatar"}}),t._v(" "),n("small",[n("i",{staticClass:"el-icon-caret-bottom",staticStyle:{color:"#888"}})])]),t._v(" "),n("ul",{staticClass:"team-menu"},[n("li",{staticClass:"clickable-item"},[n("router-link",{attrs:{to:{name:"UserSettings",params:{tid:t.$route.params.tid}}}},[t._v("个人设置")])],1),t._v(" "),n("li",{staticClass:"part-line"}),t._v(" "),n("li",{staticClass:"clickable-item"},[n("a",{attrs:{href:"#"},on:{click:t.logout}},[t._v("退出")])])])])],1),t._v(" "),t._l(t.$route.params.path||[],function(e,i){return n("div",{key:i,on:{click:function(n){t.go(e.params)}}},[n("el-card",{staticClass:"path"},[t._v("\n      "+t._s(e.name)+"\n    ")])],1)}),t._v(" "),n("el-card",{staticClass:"module-container"},[n("router-view",{attrs:{teamName:t.currentTeam.name,owner:t.currentTeam.uid,changeTeamName:t.updateTeamName,members:t.members}})],1)],2)},staticRenderFns:[]},N=n("VU/8")(j,B,!1,function(t){n("gTVl")},null,null).exports,M={name:"ProjectItem",props:["project","handleChangeColor","handleChangeIcon"],data:function(){return{colorSet:["#e9ddcf","#e4edd1","#dbeee6","#8cb6c7","#8fa6d1","#dba8ba","#b9c0c7"],icons:["el-icon-star-on","el-icon-date","el-icon-document","el-icon-message","el-icon-location","el-icon-menu","el-icon-picture","el-icon-picture-outline","el-icon-printer","el-icon-service","el-icon-star-off","el-icon-tickets","el-icon-setting","el-icon-rank","el-icon-view"]}},computed:{currentColor:function(){return this.colorSet[this.project.color]}},methods:{changeIcon:function(t){this.handleChangeIcon&&this.handleChangeIcon(this.project,t)},changeColor:function(t){this.handleChangeColor&&this.handleChangeColor(this.project,t)},enterProject:function(t){return void 0===t.target.dataset.mark&&(we.push({name:"Project",params:{pid:this.project.pid}}),!0)}}},V={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"project-item-container",attrs:{align:"center"},on:{click:t.enterProject}},[n("i",{class:t.icons[t.project.icon],staticStyle:{padding:"20px 70px",display:"block","font-size":"3em"},style:{color:t.colorSet[t.project.color]}}),t._v(" "),n("span",[t._v(t._s(t.project.name))]),t._v(" "),n("el-popover",{attrs:{placement:"bottom",width:"200",trigger:"click"}},[n("i",{staticClass:"el-icon-info edit-icon",attrs:{slot:"reference","data-mark":"1"},slot:"reference"}),t._v(" "),n("div",{staticClass:"project-info-edit-container"},[n("ul",t._l(t.colorSet,function(e,i){return n("li",{key:i,staticClass:"color-item",style:{"background-color":e},on:{click:function(e){t.changeColor(i)}}})})),t._v(" "),n("ul",{staticStyle:{"margin-top":"10px"}},t._l(t.icons,function(e,i){return n("li",{key:i,staticClass:"icon-item",on:{click:function(e){t.changeIcon(i)}}},[n("i",{class:e,staticStyle:{"font-size":"2em"},style:{color:t.currentColor}})])}))])])],1)},staticRenderFns:[]},z={name:"Project",created:function(){this.getProjects(this.$route.params.tid)},beforeRouteUpdate:function(t,e,n){t.params.tid!==e.params.tid&&this.getProjects(t.params.tid),n()},data:function(){var t=this;return{projectList:[],handleChangeIcon:function(e,n){(function(t,e){return x("/index.php/project/setIcon?pid="+encodeURIComponent(t),{method:"POST",body:"icon="+encodeURIComponent(e)})})(e.pid,n).then(function(i){if(i.error)throw Error("更新图标失败");var a=t.projectList.indexOf(e);a>-1&&(t.projectList[a].icon=n)}).catch(function(){t.$message.error("更新图标失败")})},handleChangeColor:function(e,n){(function(t,e){return x("/index.php/project/setColor?pid="+encodeURIComponent(t),{method:"POST",body:"color="+encodeURIComponent(e)})})(e.pid,n).then(function(i){if(i.error)throw Error("更新颜色失败");var a=t.projectList.indexOf(e);a>-1&&(t.projectList[a].color=n)}).catch(function(){t.$message.error("更新颜色失败")})}}},methods:{createProject:function(){var t=this;this.$prompt("请输入项目名","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/.+/,inputErrorMessage:"项目名不可为空"}).then(function(e){var n=e.value;(function(t,e){return x("/index.php/team/createProject?tid="+encodeURIComponent(t),{method:"POST",body:"name="+encodeURIComponent(e)})})(t.$route.params.tid,n).then(function(e){if(e.error)throw Error(e.error);t.projectList.push({pid:e.data,name:n,icon:0,color:0})}).catch(function(){t.$message.error("创建失败!")})}).catch(function(){})},getProjects:function(t){var e=this;(function(t){return x("/index.php/team/projects?tid="+encodeURIComponent(t))})(t).then(function(t){if(t.error)throw Error(t.error);e.projectList=t.data}).catch(function(){e.$message.error("获取项目列表失败!")})}},components:{ProjectItem:n("VU/8")(M,V,!1,function(t){n("qk+Y")},null,null).exports}},A={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"projects-header"},[n("i",{staticClass:"el-icon-tickets",staticStyle:{"font-size":"1.2em"}}),t._v(" "),n("el-button",{staticStyle:{float:"right"},attrs:{type:"text"},on:{click:t.createProject}},[t._v("新建项目")])],1),t._v(" "),n("div",{staticClass:"projects-container"},t._l(t.projectList,function(e,i){return n("project-item",{key:i,staticStyle:{margin:"20px 10px"},attrs:{handleChangeIcon:t.handleChangeIcon,handleChangeColor:t.handleChangeColor,project:e}})}))])},staticRenderFns:[]},J=n("VU/8")(z,A,!1,function(t){n("83Ex")},null,null).exports,q={name:"Settings",props:["teamName","changeTeamName"],methods:{editTeamName:function(){var t=this;this.$prompt("请输入新的团队名","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputValue:this.teamName,inputPattern:/.+/,inputErrorMessage:"新团队名不可为空"}).then(function(e){var n=e.value;(function(t,e){return x("/index.php/team/setName?tid="+encodeURIComponent(t),{method:"POST",body:"name="+encodeURIComponent(e)})})(t.$route.params.tid,n).then(function(e){if(e.error)throw Error(e.error);t.changeTeamName(n)}).catch(function(e){t.$message.error(e.message)})}).catch(function(){})},deleteTeam:function(){var t=this;this.$confirm("此操作将永久删除该团队且无法恢复, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){(function(t){return x("/index.php/team/deleteTeam",{method:"POST",body:"tid="+encodeURIComponent(t)})})(t.$route.params.tid).then(function(e){if(e.error)throw Error(e.error);t.$message({type:"success",message:"删除成功!"}),we.push({name:"Launchpad"})}).catch(function(e){t.$message.error(e.message)})}).catch(function(){})}}},Y={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("div",{staticStyle:{"border-bottom":"1px solid #eee","padding-bottom":"20px","margin-bottom":"20px"}},[e("h2",{staticStyle:{margin:"0",display:"inline","margin-right":"10px"}},[this._v(this._s(this.teamName))]),this._v(" "),e("el-button",{attrs:{type:"text"},on:{click:this.editTeamName}},[this._v("修改团队名称")])],1),this._v(" "),e("div",{staticClass:"operation-container"},[e("h3",{staticStyle:{margin:"0"}},[this._v("删除团队")]),this._v(" "),e("p",{staticStyle:{margin:"0"}},[this._v("如果你和你的团队成员，从今往后都不再需要访问该团队的信息，可以删除团队账户。")]),this._v(" "),e("el-button",{staticClass:"operation-button",attrs:{size:"small",type:"danger",plain:""},on:{click:this.deleteTeam}},[this._v("了解风险，删除当前团队")])],1)])},staticRenderFns:[]},H=n("VU/8")(q,Y,!1,function(t){n("dt3N")},null,null).exports,G=n("mvHQ"),K=n.n(G),Z={name:"MemberInfo",props:["user"],computed:{path:function(){return[{name:"团队",params:{name:this.$route.name,params:JSON.parse(K()(this.$route.params))}}]}}},Q={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"member-item-container"},[e("div",{staticStyle:{display:"flex","align-items":"center"}},[e("img",{staticClass:"avatar",attrs:{width:"64",height:"64",src:this.user.avatar,alt:"avatar"}}),this._v(" "),e("router-link",{staticClass:"username-link",staticStyle:{"line-height":"64px","margin-left":"10px"},attrs:{to:{name:"UserInfo",params:{tid:this.$route.params.tid,uid:this.user.uid,path:this.path}}}},[e("b",[this._v(this._s(this.user.name))])])],1),this._v(" "),e("span",{staticStyle:{"margin-right":"10px"}},[this._v(this._s(this.user.email))])])},staticRenderFns:[]},W=n("VU/8")(Z,Q,!1,function(t){n("a6uz")},null,null).exports,X={name:"Member",props:["teamName","owner"],created:function(){this.getMembers(this.$route.params.tid)},data:function(){return{members:[],showLinkDialog:!1}},computed:h()({},Object(f.c)(["user"]),{acceptedMembers:function(){return this.members.filter(function(t){return"1"===t.accept})},applyingMembers:function(){return this.members.filter(function(t){return"0"===t.accept})},invideLink:function(){return window.location.protocol+"//"+window.location.host+"/#/team/"+this.$route.params.tid+"/applyTeam"}}),methods:{getMembers:function(t){var e=this;(function(t){return x("/index.php/team/getMembers?tid="+encodeURIComponent(t))})(t).then(function(t){if(t.error)throw Error("获取成员列表失败");e.members=t.data}).catch(function(){e.$message.error("获取成员列表失败")})},rejectApply:function(t){var e=this;(function(t,e){return x("/index.php/team/rejectApply?tid="+encodeURIComponent(t),{method:"POST",body:"uid="+encodeURIComponent(e)})})(this.$route.params.tid,t.uid).then(function(n){if(n.error)throw Error(n.error);var i=e.members.indexOf(t);e.members.splice(i,1)}).catch(function(t){e.$message.error(t.message)})},acceptApply:function(t){var e=this;(function(t,e){return x("/index.php/team/acceptApply?tid="+encodeURIComponent(t),{method:"POST",body:"uid="+encodeURIComponent(e)})})(this.$route.params.tid,t.uid).then(function(n){if(n.error)throw Error(n.error);var i=e.members.indexOf(t);t.accept="1",e.$set(e.members,i,t)}).catch(function(t){e.$message.error(t.message)})}},components:{MemberInfo:W}},tt={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticStyle:{"padding-bottom":"20px","margin-bottom":"20px"}},[n("h2",{staticStyle:{margin:"0",display:"inline","margin-right":"10px"}},[t._v(t._s(t.teamName))]),t._v(" "),n("span",{staticClass:"tips"},[t._v("(共 "+t._s(t.acceptedMembers.length)+" 人)")]),t._v(" "),t.owner===t.user.uid?n("el-button",{staticStyle:{float:"right"},attrs:{type:"text"},on:{click:function(e){t.showLinkDialog=!0}}},[t._v("邀请新成员")]):t._e()],1),t._v(" "),n("div",t._l(t.acceptedMembers,function(t){return n("member-info",{key:t.uid,attrs:{user:t}})})),t._v(" "),t.applyingMembers.length>0?n("div",[n("h4",[t._v("申请列表")]),t._v(" "),t._l(t.applyingMembers,function(e){return n("div",{key:e.uid,staticStyle:{display:"flex","align-items":"center","justify-content":"space-between"}},[n("div",{staticStyle:{display:"flex","align-items":"center"}},[n("img",{staticClass:"avatar",staticStyle:{"margin-right":"10px"},attrs:{width:"64",height:"64",src:e.avatar,alt:"avatar"}}),t._v(" "),n("div",[n("b",[t._v(t._s(e.name))]),t._v(" "),n("p",{staticClass:"tips"},[t._v(t._s(e.email))])])]),t._v(" "),n("div",[t.owner===t.user.uid?[n("el-button",{attrs:{type:"primary",size:"mini",plain:""},on:{click:function(n){t.acceptApply(e)}}},[t._v("同意")]),t._v(" "),n("el-button",{attrs:{type:"danger",size:"mini",plain:""},on:{click:function(n){t.rejectApply(e)}}},[t._v("拒绝")])]:n("span",{staticClass:"tips"},[t._v("审核中")])],2)])})],2):t._e(),t._v(" "),n("el-dialog",{attrs:{title:"提示",visible:t.showLinkDialog,width:"30%"},on:{"update:visible":function(e){t.showLinkDialog=e}}},[n("span",[t._v("将下面的公共邀请链接通过QQ或微信发送给需要邀请的人")]),t._v(" "),n("el-input",{attrs:{value:t.invideLink,readonly:""}}),t._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"primary"},on:{click:function(e){t.showLinkDialog=!1}}},[t._v("确 定")])],1)],1)],1)},staticRenderFns:[]},et=n("VU/8")(X,tt,!1,function(t){n("LoFE")},null,null).exports,nt=["image/jpg","image/jpeg","image/png"],it={name:"UserSettings",data:function(){return{form:{name:"",email:""},rules:{name:[{required:!0,message:"请输入新的名字",trigger:"blur"}],email:[{type:"email",required:!0,message:"请输入正确的邮箱地址",trigger:"blur"}]}}},created:function(){this.form={name:this.user.name,email:this.user.email}},computed:h()({},Object(f.c)(["user"]),{hasChanged:function(){return this.form.name!==this.user.name||this.form.email!==this.user.email}}),methods:h()({},Object(f.b)({update_avatar:g,update_info:k}),{upload_avatar:function(t){var e=this,n=t.target.files[0];if(n&&nt.indexOf(n.type)>=0){var i=new FormData;i.append("avatar",n),function(t){return x("/index.php/user/avatar",{method:"POST",headers:{},body:t})}(i).then(function(t){if(t.error)throw Error(t.error);e.update_avatar(t.data)}).catch(function(n){t.target.value="",e.$message.error(n.message)})}else this.$message.error("只支持jpg/png格式"),t.target.value=""},save_info:function(){var t=this;this.$refs.form.validate(function(e){if(e){var n=t.form,i=n.name,a=n.email;(function(t,e){return x("/index.php/user/updateInfo",{method:"POST",body:"name="+encodeURIComponent(t)+"&email="+encodeURIComponent(e)})})(i,a).then(function(e){if(e.error)throw Error(e.error);t.$message({message:"保存成功",type:"success"}),t.update_info({name:i,email:a})}).catch(function(e){t.$message.error(e.message)})}})},exit_team:function(){var t=this;this.$confirm("确定要退出团队？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.$message({type:"success",message:"退出成功!"})}).catch(function(){})}})},at={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticStyle:{"margin-bottom":"30px"}},[n("h2",{staticStyle:{display:"inline"}},[t._v("个人设置")]),t._v(" "),n("el-button",{staticStyle:{float:"right","margin-top":"3px"},attrs:{size:"small",type:"danger",plain:""},on:{click:t.exit_team}},[t._v("退出团队")])],1),t._v(" "),n("div",{staticClass:"avatar-edit"},[n("img",{staticClass:"avatar",staticStyle:{padding:"8px",float:"left"},attrs:{width:"64",height:"64",src:t.user.avatar,alt:"avatar"}}),t._v(" "),n("el-button",{attrs:{type:"text"},on:{click:function(e){e.stopPropagation(),e.preventDefault(),t.$refs.avatarPicker.click()}}},[t._v("更换头像")]),t._v(" "),t._m(0,!1,!1),t._v(" "),n("input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"avatarPicker",attrs:{type:"file"},on:{change:t.upload_avatar}})],1),t._v(" "),n("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules,"label-width":"80px"}},[n("el-form-item",{attrs:{label:"名字",prop:"name"}},[n("el-input",{model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),t._v(" "),n("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[n("el-input",{model:{value:t.form.email,callback:function(e){t.$set(t.form,"email",e)},expression:"form.email"}})],1),t._v(" "),n("el-form-item",[n("el-button",{attrs:{type:"primary",disabled:!t.hasChanged},on:{click:t.save_info}},[t._v("保存")])],1)],1)],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("small",[e("p",{staticClass:"tips"},[this._v("你可以选择 png/jpg 图片作为头像")])])}]},st=n("VU/8")(it,at,!1,function(t){n("Y5C0")},null,null).exports,rt={name:"Task",props:["task","onBeginTask","onPauseTask","onDeleteTask","onEditTask","onFinishTask","onAllocatingTask","members","name"],computed:h()({doingIcon:function(){return"1"===this.task.doing?"el-icon-loading":"el-icon-caret-right"},allocatingUserName:function(){if(null===this.task.uid)return"未分配";for(var t=this.members,e=0;e<t.length;++e)if(t[e].uid===this.task.uid)return t[e].name;return""},path:function(){var t=JSON.parse(K()(this.$route.params.path||[]));return this.name&&t.push({name:this.name,params:{name:this.$route.name,params:JSON.parse(K()(this.$route.params))}}),t}},Object(f.c)(["user"])),methods:{handleOnDelete:function(){var t=this;this.$confirm("确定删除任务？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){E(t.task.taskId).then(function(e){if(e.error)throw Error(e.error);t.onDeleteTask(t.task)}).catch(function(e){t.$message.error(e.message)})}).catch(function(){})},handleOnEdit:function(){var t=this;this.$prompt("请输入新的任务名","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputValue:this.task.name,inputPattern:/.+/,inputErrorMessage:"任务名不能为空"}).then(function(e){var n=e.value;(function(t,e){return x("/index.php/task/edit",{method:"POST",body:"taskId="+encodeURIComponent(t)+"&name="+encodeURIComponent(e)})})(t.task.taskId,n).then(function(e){if(e.error)throw Error(e.error);t.task.name=n,t.onEditTask(t.task)}).catch(function(e){t.$message.error(e.message)})}).catch(function(){})},handleOnDoing:function(){var t=this;"1"===this.task.doing?function(t){return x("/index.php/task/pause",{method:"POST",body:"taskId="+encodeURIComponent(t)})}(this.task.taskId).then(function(e){if(e.error)throw Error(e.error);t.task.doing="0",t.onPauseTask(t.task)}).catch(function(e){t.$message.error(e.message)}):function(t){return x("/index.php/task/begin",{method:"POST",body:"taskId="+encodeURIComponent(t)})}(this.task.taskId).then(function(e){if(e.error)throw Error(e.error);t.task.doing="1",t.task.uid=t.user.uid,t.onBeginTask(t.task)}).catch(function(e){t.$message.error(e.message)})},allocatingTask:function(t){var e=this;(function(t,e){return x("/index.php/task/allocating",{method:"POST",body:"uid="+encodeURIComponent(e)+"&taskId="+encodeURIComponent(t)})})(this.task.taskId,t).then(function(n){if(n.error)throw Error(n.error);e.task.uid=t||null,e.task.doing="0",e.onAllocatingTask(e.task,t||null)}).catch(function(t){e.$message.error(t.message)})},handleFinishTask:function(t){var e=this;t.target.checked?function(t){return x("/index.php/task/markFinished",{method:"POST",body:"taskId="+encodeURIComponent(t)})}(this.task.taskId).then(function(t){if(t.error)throw Error(t.error);e.task.finished=Date.now(),e.onFinishTask(e.task)}).catch(function(t){e.$message.error(t.message)}):function(t){return x("/index.php/task/markUnfinished",{method:"POST",body:"taskId="+encodeURIComponent(t)})}(this.task.taskId).then(function(t){if(t.error)throw Error(t.error);e.task.finished=null,e.onFinishTask(e.task)}).catch(function(t){e.$message.error(t.message)})}}},ot={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("el-popover",{attrs:{placement:"left",width:"150",trigger:"hover"}},[n("div",{staticStyle:{float:"right"}},[n("i",{staticClass:"icon-button el-icon-star-on",staticStyle:{color:"#eee"}}),t._v(" "),n("i",{staticClass:"icon-button el-icon-star-on",staticStyle:{color:"#eee"}}),t._v(" "),n("el-button",{staticClass:"icon-button",attrs:{title:"删除",type:"text",icon:"el-icon-delete"},on:{click:t.handleOnDelete}}),t._v(" "),null===t.task.finished?n("el-button",{staticClass:"icon-button",attrs:{title:"编辑",type:"text",icon:"el-icon-edit"},on:{click:t.handleOnEdit}}):t._e(),t._v(" "),null===t.task.finished?n("el-button",{staticClass:"icon-button",attrs:{title:"开始任务",type:"text",icon:t.doingIcon},on:{click:t.handleOnDoing}}):t._e()],1),t._v(" "),n("div",{staticClass:"task-container",attrs:{slot:"reference"},slot:"reference"},[n("input",{attrs:{type:"checkbox"},domProps:{checked:null!==t.task.finished},on:{change:t.handleFinishTask}}),t._v(" "),t.$route.params.task_id?n("h3",{staticClass:"task-name",staticStyle:{display:"inline"},attrs:{type:"text"}},[t._v(t._s(t.task.name))]):n("router-link",{attrs:{to:{name:"TaskDetail",params:{task_id:t.task.taskId,path:t.path}}}},[n("el-button",{staticClass:"task-name",attrs:{type:"text"}},[t._v(t._s(t.task.name))])],1),t._v(" "),null===t.task.finished?n("el-popover",{attrs:{placement:"right",width:"150",trigger:"click"}},[n("div",[n("p",{staticStyle:{margin:"0",padding:"0","font-weight":"800"}},[t._v("将任务指派给")]),t._v(" "),n("el-select",{attrs:{clearable:"",placeholder:"未指派任务",size:"mini"},on:{change:t.allocatingTask},model:{value:t.task.uid,callback:function(e){t.$set(t.task,"uid",e)},expression:"task.uid"}},t._l(t.members,function(t){return n("el-option",{key:t.uid,attrs:{label:t.name,value:t.uid}})}))],1),t._v(" "),n("el-tag",{staticClass:"tag tag-clickable",attrs:{slot:"reference",size:"small",type:"info"},slot:"reference"},[t._v("\n          "+t._s(t.allocatingUserName)+"\n        ")])],1):n("el-tag",{staticClass:"tag",attrs:{size:"small",type:"info"}},[t._v("\n        "+t._s(t.allocatingUserName)+"\n      ")]),t._v(" "),t.task.projectName?n("el-tag",{staticClass:"tag",attrs:{size:"small",type:"info"}},[t._v("\n        "+t._s(t.task.projectName)+"\n      ")]):t._e()],1)])],1)},staticRenderFns:[]},ct=n("VU/8")(rt,ot,!1,function(t){n("1iMi")},null,null).exports,lt={name:"UserInfo",props:["members"],mounted:function(){this.getUnfinishedTasks()},data:function(){var t=this;return{user:{uid:"",name:"",email:"",avatar:""},tasks:[],onDeleteTask:function(e){var n=t.tasks.indexOf(e);t.tasks.splice(n,1)},onEditTask:function(e){var n=t.tasks.indexOf(e);t.$set(t.tasks,n,e)},onBeginTask:function(e){var n=t.tasks.indexOf(e);t.$set(t.tasks,n,e)},onPauseTask:function(e){var n=t.tasks.indexOf(e);t.$set(t.tasks,n,e)},onFinishTask:function(e){var n=t.tasks.indexOf(e);t.tasks.splice(n,1)},onAllocatingTask:function(e){var n=t.tasks.indexOf(e);t.$set(t.tasks,n,e)}}},components:{Task:ct},methods:{viewFinishedTasks:function(){var t=JSON.parse(K()(this.$route.params.path||[]));t.push({name:this.user.name,params:{name:this.$route.name,params:JSON.parse(K()(this.$route.params))}}),we.push({name:"FinishedTasks",params:{uid:this.$route.params.uid,path:t}})},getUnfinishedTasks:function(){var t=this,e=this.$route.params;(function(t,e){return x("/index.php/team/taskUnfinished?tid="+encodeURIComponent(t)+"&uid="+encodeURIComponent(e))})(e.tid,e.uid).then(function(e){if(e.error)throw Error(e.error);t.tasks=e.data.tasks,t.user=e.data.user}).catch(function(e){t.$message.error(e.message)})}}},dt={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"userinfo-header"},[n("img",{staticClass:"avatar",staticStyle:{float:"left","padding-left":"10px","padding-right":"20px"},attrs:{width:"80",height:"80",src:t.user.avatar,alt:"avatar"}}),t._v(" "),n("h2",{staticStyle:{margin:"0",padding:"0"}},[t._v(t._s(t.user.name))]),t._v(" "),n("p",{staticClass:"tips"},[t._v(t._s(t.user.email))])]),t._v(" "),t._m(0,!1,!1),t._v(" "),n("div",{staticStyle:{"margin-left":"30px"}},[t._m(1,!1,!1),t._v(" "),t._l(t.tasks,function(e){return n("task",{key:e.task_id,attrs:{onDeleteTask:t.onDeleteTask,onEditTask:t.onEditTask,onBeginTask:t.onBeginTask,onPauseTask:t.onPauseTask,onFinishTask:t.onFinishTask,onAllocatingTask:t.onAllocatingTask,members:t.members,task:e,name:t.user.name}})})],2),t._v(" "),n("div",{staticStyle:{margin:"20px 0 0 30px"}},[n("el-button",{attrs:{type:"text"},on:{click:t.viewFinishedTasks}},[t._v("\n      查看已完成任务\n    ")])],1)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("ul",{staticClass:"userinfo-nav"},[e("li",{staticClass:"activate"},[this._v("任务")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h5",{staticClass:"sort-label"},[e("i",{staticClass:"el-icon-tickets"}),this._v(" 未完成任务")])}]},ut=n("VU/8")(lt,dt,!1,function(t){n("4Ida")},null,null).exports,mt={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"file-item",attrs:{align:"center"}},[e("i",{staticClass:"el-icon-document",staticStyle:{padding:"20px 50px",display:"block","font-size":"5em"}}),this._v(" "),e("span",{staticClass:"item-name",attrs:{title:this.file.name}},[this._v(this._s(this.file.name))]),this._v(" "),e("div",{staticClass:"operation"},[e("a",{attrs:{href:this.file.path,download:this.file.name}},[e("el-button",{attrs:{type:"text"}},[this._v("下载")])],1),this._v(" "),e("el-button",{attrs:{type:"text"},on:{click:this.handleDelete}},[this._v("删除")])],1)])},staticRenderFns:[]},pt={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("router-link",{attrs:{to:{name:"FileBrowser",params:{dir_id:t.dir.dir_id,path:t.path}}}},[n("div",{staticClass:"dir-item",attrs:{align:"center"}},[n("i",{staticClass:"el-icon-message",staticStyle:{padding:"20px 50px",display:"block","font-size":"5em",color:"lightblue"}}),t._v(" "),n("span",{staticClass:"item-name",attrs:{title:t.dir.name}},[t._v(t._s(t.dir.name))]),t._v(" "),n("div",{staticClass:"operation"},[n("el-button",{attrs:{type:"text"},on:{click:function(e){e.stopPropagation(),e.preventDefault(),t.handleDeleteDir(e)}}},[t._v("删除")])],1)])])},staticRenderFns:[]},ht={name:"FileBrowser",props:["dirId","name"],created:function(){this.getFileList()},data:function(){return{dirs:[],files:[],parent:[]}},computed:{id:function(){return this.dirId||this.$route.params.dir_id},path:function(){var t=JSON.parse(K()(this.$route.params.path||[]));return this.name&&t.push({name:this.name,params:{name:this.$route.name,params:JSON.parse(K()(this.$route.params))}}),t}},methods:{selectFile:function(){this.$refs.filePicker.click()},createDir:function(){var t=this;this.$prompt("请输入文件夹名称","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/.+/,inputErrorMessage:"文件夹名不可为空"}).then(function(e){var n=e.value;(function(t,e){return x("/index.php/file/createDir",{method:"POST",body:"dirId="+encodeURIComponent(t)+"&dirName="+encodeURIComponent(e)})})(t.id,n).then(function(e){if(e.error)throw Error(e.error);t.dirs.push({dir_id:e.data,name:n})}).catch(function(e){t.$message.error(e.message)})}).catch(function(){})},handleCommand:function(t){"file"===t?this.selectFile():this.createDir()},uploadFile:function(t){var e=this,n=t.target.files[0];t.target.value="";var i=new FormData;i.append("file",n),i.append("dirId",this.id),function(t){return x("/index.php/file/upload",{method:"POST",headers:{},body:t})}(i).then(function(t){if(t.error)throw Error(t.error);e.files.push({fid:t.data.fid,name:n.name,path:t.data.path})}).catch(function(t){e.$message.error(t.message)})},deleteDir:function(t){var e=this;this.$confirm("删除文件夹会同时将文件夹下的所有文件删除，是否继续？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){(function(t){return x("/index.php/file/deleteDir",{method:"POST",body:"dirId="+encodeURIComponent(t)})})(t.dir_id).then(function(n){if(n.error)throw Error(n.error);var i=e.dirs.indexOf(t);e.dirs.splice(i,1)}).catch(function(t){e.$message.error(t.message)})}).catch(function(){})},deleteFile:function(t){var e=this;this.$confirm("删除后将无法还原，是否继续？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){(function(t){return x("/index.php/file/deleteFile",{method:"POST",body:"fid="+encodeURIComponent(t)})})(t.fid).then(function(n){if(n.error)throw Error(n.error);var i=e.files.indexOf(t);e.files.splice(i,1)}).catch(function(t){e.$message.error(t.message)})}).catch(function(){})},getFileList:function(){var t=this;this.id&&function(t){return x("/index.php/file/getInfo?dirId="+encodeURIComponent(t))}(this.id).then(function(e){if(e.error)throw Error(e.error);t.dirs=e.data.dirs,t.files=e.data.files,t.parent=e.data.parent}).catch(function(e){t.$message.error(e.message)})}},components:{FileItem:n("VU/8")({name:"FileItem",props:["file","onDeleteFile"],methods:{handleDelete:function(){this.onDeleteFile&&this.onDeleteFile(this.file)}}},mt,!1,function(t){n("cOlY")},null,null).exports,DirItem:n("VU/8")({name:"DirItem",props:["dir","onDeleteDir","path"],methods:{handleDeleteDir:function(){this.onDeleteDir&&this.onDeleteDir(this.dir)}}},pt,!1,function(t){n("Mcfc")},null,null).exports},watch:{id:function(){this.getFileList()}}},ft={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",[t.id===t.$route.params.dir_id?n("el-breadcrumb",{attrs:{separator:">"}},t._l(t.parent,function(e){return n("el-breadcrumb-item",{key:e.dir_id,attrs:{to:{name:"FileBrowser",params:{dir_id:e.dir_id,path:t.path}}}},[t._v("\n        "+t._s(e.name)+"\n      ")])})):t._e(),t._v(" "),n("h3",{staticClass:"module-name"},[t._v("\n      "+t._s(t.id===t.$route.params.dir_id?t.parent.length>0?t.parent[t.parent.length-1].name:"Loading":"文件")+"\n    ")]),t._v(" "),n("el-dropdown",{attrs:{"split-button":"",type:"primary",trigger:"click",size:"mini"},on:{click:t.selectFile,command:t.handleCommand}},[t._v("\n      上传文件\n      "),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[n("el-dropdown-item",{attrs:{command:"file"}},[t._v("上传文件")]),t._v(" "),n("el-dropdown-item",{attrs:{command:"dir"}},[t._v("创建文件夹")])],1)],1),t._v(" "),n("input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"filePicker",attrs:{type:"file"},on:{change:t.uploadFile}}),t._v(" "),n("div",{staticStyle:{display:"flex","flex-wrap":"wrap"}},[t._l(t.dirs,function(e){return n("dir-item",{key:e.dir_id,attrs:{dir:e,onDeleteDir:t.deleteDir,path:t.path}})}),t._v(" "),t._l(t.files,function(e){return n("file-item",{key:e.fid,attrs:{file:e,onDeleteFile:t.deleteFile}})})],2)],1)])},staticRenderFns:[]},vt=n("VU/8")(ht,ft,!1,function(t){n("EBsE")},null,null).exports,gt={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("router-link",{attrs:{to:{name:"DocumentBrowser",params:{doc_dir_id:t.dir.doc_dir_id,path:t.path}}}},[n("div",{staticClass:"dir-item",attrs:{align:"center"}},[n("i",{staticClass:"el-icon-message",staticStyle:{padding:"20px 50px",display:"block","font-size":"5em",color:"lightblue"}}),t._v(" "),n("span",{staticClass:"item-name",attrs:{title:t.dir.name}},[t._v(t._s(t.dir.name))]),t._v(" "),n("div",{staticClass:"operation"},[n("el-button",{attrs:{type:"text"},on:{click:function(e){e.stopPropagation(),e.preventDefault(),t.handleDeleteDir(e)}}},[t._v("删除")])],1)])])},staticRenderFns:[]},kt=n("VU/8")({name:"DirItem",props:["dir","onDeleteDir","path"],methods:{handleDeleteDir:function(){this.onDeleteDir&&this.onDeleteDir(this.dir)}}},gt,!1,function(t){n("9VxE")},null,null).exports,_t={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("router-link",{attrs:{to:{name:"DocumentEditor",params:{doc_id:t.doc.doc_id,path:t.path}}}},[n("div",{staticClass:"doc-item",attrs:{align:"center"}},[n("i",{staticClass:"el-icon-document",staticStyle:{padding:"20px 50px",display:"block","font-size":"5em"}}),t._v(" "),n("span",{staticClass:"item-name",attrs:{title:t.doc.name}},[t._v(t._s(t.doc.name))]),t._v(" "),n("div",{staticClass:"operation"},[n("el-button",{attrs:{type:"text"},on:{click:function(e){e.stopPropagation(),e.preventDefault(),t.handleDeleteDoc(e)}}},[t._v("删除")])],1)])])},staticRenderFns:[]},bt={name:"DocumentBrowser",props:["docDirId","name"],created:function(){this.getDocList()},data:function(){return{docs:[],dirs:[],parent:[]}},computed:{id:function(){return this.docDirId||this.$route.params.doc_dir_id},path:function(){var t=JSON.parse(K()(this.$route.params.path||[]));return this.name&&t.push({name:this.name,params:{name:this.$route.name,params:JSON.parse(K()(this.$route.params))}}),t}},methods:{createDoc:function(){var t=this;this.$prompt("请输入文档名称","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/.+/,inputErrorMessage:"文档名不可为空"}).then(function(e){var n=e.value;(function(t,e){return x("/index.php/document/create",{method:"POST",body:"dirId="+encodeURIComponent(t)+"&docName="+encodeURIComponent(e)})})(t.id,n).then(function(e){if(e.error)throw Error(e.error);t.docs.push({doc_id:e.data,name:n})}).catch(function(e){t.$message.error(e.message)})}).catch(function(){})},createDir:function(){var t=this;this.$prompt("请输入文档夹名称","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/.+/,inputErrorMessage:"文档夹名不可为空"}).then(function(e){var n=e.value;(function(t,e){return x("/index.php/document/createDir",{method:"POST",body:"dirId="+encodeURIComponent(t)+"&dirName="+encodeURIComponent(e)})})(t.id,n).then(function(e){if(e.error)throw Error(e.error);t.dirs.push({doc_dir_id:e.data,name:n})}).catch(function(e){t.$message.error(e.message)})}).catch(function(){})},handleCommand:function(t){"doc"===t?this.createDoc():this.createDir()},deleteDir:function(t){var e=this;this.$confirm("删除文档夹会同时将文档夹下的所有文档删除，是否继续？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){(function(t){return x("/index.php/document/deleteDir",{method:"POST",body:"dirId="+encodeURIComponent(t)})})(t.doc_dir_id).then(function(n){if(n.error)throw Error(n.error);var i=e.dirs.indexOf(t);e.dirs.splice(i,1)}).catch(function(t){e.$message.error(t.message)})}).catch(function(){})},deleteDoc:function(t){var e=this;this.$confirm("删除后将无法还原，是否继续？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){(function(t){return x("/index.php/document/deleteDoc",{method:"POST",body:"docId="+encodeURIComponent(t)})})(t.doc_id).then(function(n){if(n.error)throw Error(n.error);var i=e.docs.indexOf(t);e.docs.splice(i,1)}).catch(function(t){e.$message.error(t.message)})}).catch(function(){})},getDocList:function(){var t=this;this.id&&function(t){return x("/index.php/document/getInfo?dirId="+encodeURIComponent(t))}(this.id).then(function(e){if(e.error)throw Error(e.error);t.dirs=e.data.dirs,t.docs=e.data.docs,t.parent=e.data.parent}).catch(function(e){t.$message.error(e.message)})}},components:{DocItem:n("VU/8")({name:"DocItem",props:["doc","onDeleteDoc","path"],methods:{handleDeleteDoc:function(){this.onDeleteDoc&&this.onDeleteDoc(this.doc)}}},_t,!1,function(t){n("W2uI")},null,null).exports,DocDirItem:kt},watch:{id:function(){this.getDocList()}}},yt={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",[t.id===t.$route.params.doc_dir_id?n("el-breadcrumb",{attrs:{separator:">"}},t._l(t.parent,function(e){return n("el-breadcrumb-item",{key:e.doc_dir_id,attrs:{to:{name:"DocumentBrowser",params:{doc_dir_id:e.doc_dir_id,path:t.path}}}},[t._v("\n        "+t._s(e.name)+"\n      ")])})):t._e(),t._v(" "),n("h3",{staticClass:"module-name"},[t._v("\n      "+t._s(t.id===t.$route.params.doc_dir_id?t.parent.length>0?t.parent[t.parent.length-1].name:"Loading":"文档")+"\n    ")]),t._v(" "),n("el-dropdown",{attrs:{"split-button":"",type:"primary",trigger:"click",size:"mini"},on:{click:t.createDoc,command:t.handleCommand}},[t._v("\n      创建文档\n      "),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[n("el-dropdown-item",{attrs:{command:"doc"}},[t._v("创建文档")]),t._v(" "),n("el-dropdown-item",{attrs:{command:"dir"}},[t._v("创建文档夹")])],1)],1),t._v(" "),n("div",{staticStyle:{display:"flex","flex-wrap":"wrap"}},[t._l(t.dirs,function(e){return n("doc-dir-item",{key:e.doc_dir_id,attrs:{dir:e,onDeleteDir:t.deleteDir,path:t.path}})}),t._v(" "),t._l(t.docs,function(e){return n("doc-item",{key:e.doc_id,attrs:{doc:e,onDeleteDoc:t.deleteDoc,path:t.path}})})],2)],1)])},staticRenderFns:[]},Tt=n("VU/8")(bt,yt,!1,function(t){n("GxPi")},null,null).exports,xt={name:"ProjectMenu",props:["name","icon","link"],methods:{go:function(){we.push(this.link)}}},Ct={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"menu-item-container",attrs:{align:"center"},on:{click:this.go}},[isNaN(parseInt(this.icon))?e("i",{staticClass:"menu-item-icon",class:this.icon,staticStyle:{"padding-top":"3px",height:"22px"}}):e("span",{staticClass:"menu-item-icon"},[this._v(this._s(this.icon))]),this._v(" "),e("span",[this._v(this._s(this.name))])])},staticRenderFns:[]},$t={name:"Project",props:["members"],components:{FileBrowser:vt,DocumentBrowser:Tt,Task:ct,ProjectMenu:n("VU/8")(xt,Ct,!1,function(t){n("Y2Kz")},null,null).exports},mounted:function(){this.getProjectInfo()},data:function(){var t=this;return{tasks:[],taskLists:[],discussions:[],project:{name:"",dirId:null,docDirId:null,description:"loading"},onDeleteTask:function(e){var n=t.tasks.indexOf(e);t.tasks.splice(n,1)},onEditTask:function(e){var n=t.tasks.indexOf(e);t.$set(t.tasks,n,e)},onBeginTask:function(e){var n=t.tasks.indexOf(e);t.$set(t.tasks,n,e)},onPauseTask:function(e){var n=t.tasks.indexOf(e);t.$set(t.tasks,n,e)},onFinishTask:function(e){var n=t.tasks.indexOf(e);t.tasks.splice(n,1)},onAllocatingTask:function(e){var n=t.tasks.indexOf(e);t.$set(t.tasks,n,e)}}},computed:h()({},Object(f.c)(["user"]),{isMember:function(){var t=this;return this.members.filter(function(e){return e.uid===t.user.uid}).length>0},path:function(){return[{name:this.project.name,params:{name:this.$route.name,params:JSON.parse(K()(this.$route.params))}}]}}),methods:{addTask:function(t){var e=this;this.$prompt("请输入任务名","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/.+/,inputErrorMessage:"任务名不可为空"}).then(function(n){var i=n.value;S(e.$route.params.pid,i,t).then(function(n){if(n.error)throw Error(n.error);e.tasks.push({taskId:n.data,uid:e.user.uid,name:i,taskListId:t||null,doing:"0",finished:null})}).catch(function(t){e.$message.error(t.message)})}).catch(function(){})},addTaskList:function(){var t=this;this.$prompt("请输入任务清单名","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/.+/,inputErrorMessage:"清单名不可为空"}).then(function(e){var n=e.value;(function(t,e){return x("/index.php/task/createTaskList",{method:"POST",body:"pid="+encodeURIComponent(t)+"&name="+encodeURIComponent(e)})})(t.$route.params.pid,n).then(function(e){if(e.error)throw Error(e.error);t.taskLists.push({taskListId:e.data,name:n})}).catch(function(e){t.$message.error(e.message)})}).catch(function(){})},handleCommand:function(t){"task"===t?this.addTask():this.addTaskList()},handleOnDeleteTaskList:function(t){var e=this;this.$confirm("删除任务清单会将任务清单下的任务一并删除，是否继续？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){w(t.taskListId).then(function(n){if(n.error)throw Error(n.error);var i=e.taskLists.indexOf(t);e.taskLists.splice(i,1)}).catch(function(t){e.$message.error(t.message)})}).catch(function(){})},handleOnEditTaskList:function(t){var e=this;this.$prompt("请输入新的任务清单名","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputValue:t.name,inputPattern:/.+/,inputErrorMessage:"清单名不可为空"}).then(function(n){var i=n.value;I(t.taskListId,i).then(function(e){if(e.error)throw Error(e.error);t.name=i}).catch(function(t){e.$message.error(t.message)})}).catch(function(){})},handleOnArchiveTaskList:function(t){var e=this;D(t.taskListId).then(function(n){if(n.error)throw Error(n.error);var i=e.taskLists.indexOf(t);e.taskLists.splice(i,1)}).catch(function(t){e.$message.error(t.message)})},addDiscusstion:function(){var t=this;this.$prompt("请输入讨论话题","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/.+/,inputErrorMessage:"话题不可为空"}).then(function(e){var n=e.value;(function(t,e){return x("/index.php/discussion/create",{method:"POST",body:"pid="+encodeURIComponent(t)+"&topic="+encodeURIComponent(e)})})(t.$route.params.pid,n).then(function(e){if(e.error)throw Error(e.error);t.discussions.push(h()({did:e.data,topic:n,description:"R.T."},t.user))}).catch(function(e){t.$message.error(e.message)})}).catch(function(){})},getProjectInfo:function(){var t=this;(function(t){return x("/index.php/project/getInfo?pid="+encodeURIComponent(t))})(this.$route.params.pid).then(function(e){if(e.error)throw Error(e.error);t.taskLists=e.data.taskLists,t.tasks=e.data.tasks,t.discussions=e.data.discussions,t.project=e.data.project}).catch(function(e){t.$message.error(e.message)})}}},wt={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"project-header"},[n("h2",{staticClass:"project-name"},[t._v(t._s(t.project.name))]),t._v(" "),n("p",{staticClass:"tips"},[t._v(t._s(t.project.description||"无项目描述"))]),t._v(" "),n("div",{staticClass:"project-menu"},[n("project-menu",{attrs:{name:"成员",icon:t.members.length,link:{name:"Member"}}}),t._v(" "),t.isMember?n("div",{staticClass:"divider"}):t._e(),t._v(" "),t.isMember?n("project-menu",{attrs:{name:"设置",icon:"el-icon-setting",link:{name:"ProjectSettings",params:{path:t.path}}}}):t._e()],1)]),t._v(" "),n("div",{staticClass:"project-tasks"},[n("div",[n("h3",{staticClass:"module-name"},[t._v("任务")]),t._v(" "),n("el-dropdown",{attrs:{"split-button":"",type:"primary",trigger:"click",size:"mini"},on:{click:function(){return t.addTask()},command:t.handleCommand}},[t._v("\n        添加任务\n        "),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[n("el-dropdown-item",{attrs:{command:"task"}},[t._v("添加任务")]),t._v(" "),n("el-dropdown-item",{attrs:{command:"taskList"}},[t._v("添加清单")])],1)],1)],1),t._v(" "),t._l(t.tasks,function(e){return null===e.taskListId?n("task",{key:e.taskId,attrs:{name:t.project.name,task:e,members:t.members,onBeginTask:t.onBeginTask,onPauseTask:t.onPauseTask,onEditTask:t.onEditTask,onDeleteTask:t.onDeleteTask,onFinishTask:t.onFinishTask,onAllocatingTask:t.onAllocatingTask}}):t._e()}),t._v(" "),t._l(t.taskLists,function(e){return n("div",{key:e.taskListId},[n("el-popover",{attrs:{placement:"left",width:"150",trigger:"hover"}},[n("div",{staticStyle:{float:"right"}},[n("i",{staticClass:"icon-button el-icon-star-on",staticStyle:{color:"#eee"}}),t._v(" "),n("i",{staticClass:"icon-button el-icon-star-on",staticStyle:{color:"#eee"}}),t._v(" "),n("el-button",{staticClass:"icon-button",attrs:{title:"删除",type:"text",icon:"el-icon-delete"},on:{click:function(n){t.handleOnDeleteTaskList(e)}}}),t._v(" "),n("el-button",{staticClass:"icon-button",attrs:{title:"编辑",type:"text",icon:"el-icon-edit"},on:{click:function(n){t.handleOnEditTaskList(e)}}}),t._v(" "),n("el-button",{staticClass:"icon-button",attrs:{title:"归档",type:"text",icon:"el-icon-sold-out"},on:{click:function(n){t.handleOnArchiveTaskList(e)}}})],1),t._v(" "),n("router-link",{attrs:{slot:"reference",to:{name:"TaskListDetail",params:{pid:t.$route.params.pid,task_list_id:e.taskListId,path:t.path}}},slot:"reference"},[n("h4",{staticClass:"task-list-name"},[t._v(t._s(e.name))])])],1),t._v(" "),t._l(t.tasks,function(i){return i.taskListId===e.taskListId?n("task",{key:i.taskId,attrs:{name:t.project.name,task:i,members:t.members,onBeginTask:t.onBeginTask,onPauseTask:t.onPauseTask,onEditTask:t.onEditTask,onDeleteTask:t.onDeleteTask,onFinishTask:t.onFinishTask,onAllocatingTask:t.onAllocatingTask}}):t._e()}),t._v(" "),n("el-button",{attrs:{type:"text"},on:{click:function(n){t.addTask(e.taskListId)}}},[t._v("添加任务")])],2)}),t._v(" "),n("router-link",{attrs:{to:{name:"ProjectFinishedTasks",params:{pid:t.$route.params.pid,path:t.path}}}},[n("el-button",{attrs:{type:"text"}},[t._v("已完成任务")])],1),t._v(" "),n("router-link",{attrs:{to:{name:"ArchivedTaskList",params:{pid:t.$route.params.pid,path:t.path}}}},[n("el-button",{attrs:{type:"text"}},[t._v("已归档任务清单")])],1)],2),t._v(" "),n("div",{staticClass:"project-discussion"},[n("div",[n("h3",{staticClass:"module-name"},[t._v("讨论")]),t._v(" "),n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.addDiscusstion}},[t._v("发起讨论")])],1),t._v(" "),t._l(t.discussions,function(e){return n("div",{key:e.did,staticClass:"discussion-container"},[n("div",{staticStyle:{display:"flex","align-items":"center"}},[n("img",{staticClass:"avatar",attrs:{width:"32",src:e.avatar,alt:"avatar"}}),t._v(" "),n("small",{staticClass:"username"},[t._v(t._s(e.name))]),t._v(" "),n("router-link",{attrs:{to:{name:"DiscussionDetail",params:{pid:t.$route.params.pid,did:e.did,path:t.path}}}},[n("el-button",{staticClass:"discussion-topic",attrs:{type:"text"}},[t._v(t._s(e.topic))])],1)],1),t._v(" "),n("span",{staticClass:"discussion-date"},[t._v(t._s(e.date))])])})],2),t._v(" "),n("file-browser",{attrs:{name:t.project.name,dirId:t.project.dirId}}),t._v(" "),n("document-browser",{attrs:{name:t.project.name,docDirId:t.project.docDirId}})],1)},staticRenderFns:[]},It=n("VU/8")($t,wt,!1,function(t){n("lPKG")},null,null).exports,Dt=n("fZjL"),St=n.n(Dt),Et={name:"FinishedTasks",mounted:function(){this.getFinishedTasks()},data:function(){return{unsortedTasks:{},user:{uid:"",name:"",email:"",avatar:""}}},computed:{title:function(){return this.user.name+" 已完成的任务"},path:function(){var t=JSON.parse(K()(this.$route.params.path||[]));return t.push({name:this.title,params:{name:this.$route.name,params:JSON.parse(K()(this.$route.params))}}),t},dateSet:function(){return this.tasks?St()(this.tasks):[]},tasks:function(){for(var t={},e=this.unsortedTasks,n=0;n<e.length;++n){var i=new Date(e[n].finished),a=i.getFullYear()+"/"+(i.getMonth()+1)+"/"+i.getDate();t[a]?t[a].push(e[n]):t[a]=[e[n]]}return t}},methods:{getFinishedTasks:function(){var t=this,e=this.$route.params;(function(t,e){return x("/index.php/team/taskFinished?tid="+encodeURIComponent(t)+"&uid="+encodeURIComponent(e))})(e.tid,e.uid).then(function(e){if(e.error)throw Error(e.error);t.unsortedTasks=e.data.tasks,t.user=e.data.user}).catch(function(e){t.$message.error(e.message)})}}},Ut={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("h3",[t._v(t._s(t.title))]),t._v(" "),t._l(t.dateSet,function(e){return n("div",{key:e,staticClass:"date-container"},[n("span",{staticClass:"date-label"},[t._v(t._s(e))]),t._v(" "),n("div",{staticClass:"tasks-container"},t._l(t.tasks[e],function(e){return n("div",{key:e.taskId,staticStyle:{"margin-bottom":"10px"}},[n("i",{staticClass:"el-icon-check finished-icon"}),t._v(" "),n("router-link",{staticClass:"task-link",attrs:{to:{name:"TaskDetail",params:{task_id:e.taskId,path:t.path}}}},[t._v("\n          "+t._s(e.name)+"\n        ")])],1)}))])})],2)},staticRenderFns:[]},Lt=n("VU/8")(Et,Ut,!1,function(t){n("mGEc")},null,null).exports,Rt={name:"DocumentEditor",created:function(){this.getDocInfo()},data:function(){return{name:"",content:"",toolbars:{bold:!0,italic:!0,header:!0,underline:!0,strikethrough:!0,mark:!0,superscript:!0,subscript:!0,quote:!0,ol:!0,ul:!0,link:!0,code:!0,table:!0,fullscreen:!0,readmodel:!0,undo:!0,redo:!0,alignleft:!0,aligncenter:!0,alignright:!0,subfield:!0,preview:!0}}},computed:{doc_id:function(){return this.$route.params.doc_id},path:function(){var t=JSON.parse(K()(this.$route.params.path||[]));return t.push({name:this.name,params:{name:this.$route.name,params:JSON.parse(K()(this.$route.params))}}),t}},methods:{submit:function(){var t=this;(function(t,e){return x("/index.php/document/saveDoc",{method:"POST",body:"content="+encodeURIComponent(e)+"&docId="+encodeURIComponent(t)})})(this.doc_id,this.content).then(function(e){if(e.error)throw Error(e.error);t.$message({message:"保存成功",type:"success"})}).catch(function(e){t.$message.error(e.message)})},editName:function(){var t=this;this.$prompt("请输入新的文档名","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputValue:this.name,inputPattern:/.+/,inputErrorMessage:"文档名不能为空"}).then(function(e){var n=e.value;(function(t,e){return x("/index.php/document/editDoc",{method:"POST",body:"docId="+encodeURIComponent(t)+"&docName="+encodeURIComponent(e)})})(t.doc_id,n).then(function(e){if(e.error)throw Error(e.error);t.name=n}).catch(function(e){t.$message.error(e.message)})}).catch(function(){})},getDocInfo:function(){var t=this;(function(t){return x("/index.php/document/getDocInfo?docId="+encodeURIComponent(t))})(this.doc_id).then(function(e){if(e.error)throw Error(e.error);t.name=e.data.name,t.content=e.data.content}).catch(function(e){t.$message.error(e.message)})}}},Ot={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("router-link",{attrs:{to:{name:"EditHistory",params:{doc_id:t.doc_id,path:t.path}}}},[n("el-button",{attrs:{type:"text"}},[t._v("查看编辑历史")])],1),t._v(" "),n("div",{staticClass:"document-info",attrs:{align:"center"}},[n("h3",{staticClass:"document-name"},[t._v("\n      "+t._s(t.name)+"\n      "),n("el-button",{staticClass:"edit-document",attrs:{type:"text"},on:{click:t.editName}},[t._v("编辑")])],1)]),t._v(" "),n("mavon-editor",{attrs:{default_open:"edit",value:t.content,toolbars:t.toolbars},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}}),t._v(" "),n("el-button",{staticStyle:{"margin-top":"15px"},attrs:{type:"primary"},on:{click:t.submit}},[t._v("发布")])],1)},staticRenderFns:[]},Ft=n("VU/8")(Rt,Ot,!1,function(t){n("zCtl")},null,null).exports,Pt={name:"FinishedTasks",created:function(){this.getProjectFinishedTasks()},data:function(){return{unsortedTasks:{}}},computed:{dateSet:function(){return St()(this.tasks)},tasks:function(){for(var t={},e=this.unsortedTasks,n=0;n<e.length;++n){var i=new Date(e[n].finished),a=i.getFullYear()+"/"+(i.getMonth()+1)+"/"+i.getDate();t[a]?t[a].push(e[n]):t[a]=[e[n]]}return t},pid:function(){return this.$route.params.pid},path:function(){var t=JSON.parse(K()(this.$route.params.path||[]));return t.push({name:"已完成的任务",params:{name:this.$route.name,params:JSON.parse(K()(this.$route.params))}}),t}},methods:{getProjectFinishedTasks:function(){var t=this;(function(t){return x("/index.php/project/finishedTasks?pid="+encodeURIComponent(t))})(this.pid).then(function(e){if(e.error)throw Error(e.error);t.unsortedTasks=e.data}).catch(function(e){t.$message.error(e.message)})}}},jt={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("h2",[t._v("已完成的任务")]),t._v(" "),t._l(t.dateSet,function(e){return n("div",{key:e,staticClass:"date-container"},[n("span",{staticClass:"date-label"},[t._v(t._s(e))]),t._v(" "),n("div",{staticClass:"tasks-container"},t._l(t.tasks[e],function(e){return n("div",{key:e.task_id,staticStyle:{"margin-bottom":"10px"}},[n("i",{staticClass:"el-icon-check finished-icon"}),t._v(" "),n("router-link",{staticClass:"task-link",attrs:{to:{name:"TaskDetail",params:{task_id:e.task_id,path:t.path}}}},[t._v(t._s(e.name))])],1)}))])})],2)},staticRenderFns:[]},Bt=n("VU/8")(Pt,jt,!1,function(t){n("fp+U")},null,null).exports,Nt={name:"FinishedTaskLists",created:function(){this.getArchivedTaskList()},data:function(){return{unsortedTaskLists:{}}},computed:{dateSet:function(){return St()(this.taskLists)},taskLists:function(){for(var t={},e=this.unsortedTaskLists,n=0;n<e.length;++n){var i=new Date(e[n].archived),a=i.getFullYear()+"/"+(i.getMonth()+1)+"/"+i.getDate();t[a]?t[a].push(e[n]):t[a]=[e[n]]}return t},pid:function(){return this.$route.params.pid},path:function(){var t=JSON.parse(K()(this.$route.params.path||[]));return t.push({name:"已归档的任务清单",params:{name:this.$route.name,params:JSON.parse(K()(this.$route.params))}}),t}},methods:{getArchivedTaskList:function(){var t=this;(function(t){return x("/index.php/project/archivedTaskList?pid="+encodeURIComponent(t))})(this.pid).then(function(e){if(e.error)throw Error(e.error);t.unsortedTaskLists=e.data}).catch(function(e){t.$message.error(e.message)})}}},Mt={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("h2",[t._v("已归档的任务清单")]),t._v(" "),t._l(t.dateSet,function(e){return n("div",{key:e,staticClass:"date-container"},[n("span",{staticClass:"date-label"},[t._v(t._s(e))]),t._v(" "),n("div",{staticClass:"tasks-container"},t._l(t.taskLists[e],function(e){return n("div",{key:e.task_list_id,staticStyle:{"margin-bottom":"10px"}},[n("i",{staticClass:"el-icon-check finished-icon"}),t._v(" "),n("router-link",{staticClass:"task-link",attrs:{to:{name:"TaskListDetail",params:{pid:t.$route.params.pid,task_list_id:e.task_list_id,path:t.path}}}},[t._v("\n          "+t._s(e.name)+"\n        ")])],1)}))])})],2)},staticRenderFns:[]},Vt=n("VU/8")(Nt,Mt,!1,function(t){n("eQcR")},null,null).exports,zt={name:"Event",props:["event","table"],methods:{getIcon:function(t){switch(t){case"create":return"el-icon-circle-plus";case"finish":return"el-icon-success";case"continue":return"el-icon-loading";case"begin":return"el-icon-caret-right";case"pause":return"el-icon-warning";case"reopen":return"el-icon-d-arrow-right";case"delete":return"el-icon-circle-close";case"archive":return"el-icon-check";case"active":return"el-icon-time";default:return""}},getInfo:function(t,e,n){return"create"===t?"创建了"+e:"finish"===t?"完成了"+e:"continue"===t?"继续执行"+e:"begin"===t?"开始执行"+e:"pause"===t?"暂停处理"+e:"reopen"===t?"恢复了"+e:"delete"===t?"删除了"+e:"archive"===t?"归档"+e:"active"===t?"激活"+e:"createTask"===t?"创建了任务"+n:""},formatDate:function(t){var e=new Date(t);return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()}}},At={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"event"},[e("span",{staticClass:"event-left",style:{color:"delete"===this.event.type?"#fd7b7e":"#55c6dc"},attrs:{align:"center"}},["comment"!=this.event.type?e("i",{class:this.getIcon(this.event.type),staticStyle:{"font-size":"2em"}}):e("img",{staticClass:"avatar",attrs:{width:"48",src:this.event.avatar,alt:"avatar"}})]),this._v(" "),"comment"!=this.event.type?e("small",{staticClass:"event-right",class:{danger:"delete"===this.event.type}},[e("span",{staticClass:"event-date"},[this._v(this._s(this.formatDate(this.event.date)))]),this._v(" "),e("span",{staticClass:"event-user"},[e("b",[this._v(this._s(this.event.name))])]),this._v(" "),e("span",{staticClass:"event-type"},[this._v(this._s(""+this.getInfo(this.event.type,this.table,this.event.info)))])]):e("small",{staticClass:"event-right"},[e("span",{staticClass:"event-user"},[e("b",[this._v(this._s(this.event.name))])]),this._v(" "),e("span",{staticClass:"event-date"},[this._v(this._s(this.formatDate(this.event.date)))]),this._v(" "),e("p",{staticStyle:{margin:"0 0 0 70px"}},[this._v(this._s(this.event.info))])])])},staticRenderFns:[]},Jt={name:"EventPanel",props:["events","table"],components:{Event:n("VU/8")(zt,At,!1,function(t){n("+U5m")},null,null).exports}},qt={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",t._l(t.events,function(e,i){return n("event",{key:i,attrs:{event:e,table:t.table}})}))},staticRenderFns:[]},Yt=n("VU/8")(Jt,qt,!1,null,null,null).exports,Ht={name:"Comment",props:["onSubmit"],data:function(){return{form:{content:""},rules:{content:[{required:!0,message:"评论内容不能为空",trigger:"blur"}]}}},computed:Object(f.c)(["user"]),methods:{handleSubmit:function(){var t=this;this.$refs.form.validate(function(e){e&&t.onSubmit&&(t.onSubmit(t.form.content),t.$refs.form.resetFields())})}}},Gt={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticStyle:{"margin-top":"20px"}},[n("div",{staticStyle:{float:"left",width:"60px"},attrs:{align:"center"}},[n("img",{staticClass:"avatar",attrs:{width:"48",height:"48",src:t.user.avatar,alt:"avatar"}})]),t._v(" "),n("div",{staticStyle:{"margin-left":"70px"}},[n("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules}},[n("el-form-item",{attrs:{prop:"content"}},[n("el-input",{attrs:{type:"textarea",rows:2,placeholder:"请输入内容"},model:{value:t.form.content,callback:function(e){t.$set(t.form,"content",e)},expression:"form.content"}})],1),t._v(" "),n("el-form-item",[n("el-button",{attrs:{type:"primary"},on:{click:t.handleSubmit}},[t._v("发表评论")])],1)],1)],1)])},staticRenderFns:[]},Kt=n("VU/8")(Ht,Gt,!1,function(t){n("EgK5")},null,null).exports,Zt={name:"TaskDetail",props:["members"],created:function(){this.getTaskInfo()},data:function(){var t=this;return{task:{name:"",description:"",uid:null,finished:null,doing:!1,deleted:"1"},events:[],showEditTask:!1,form:{name:"",description:""},rules:{name:[{required:!0,message:"任务名不能为空",trigger:"blur"}]},onDeleteTask:function(){we.go(-1)},onEditTask:function(e){t.task=e},onBeginTask:function(){t.task.doing="1"},onPauseTask:function(){t.task.doing="0"},onFinishTask:function(e){t.task=e},onAllocatingTask:function(e,n){t.task.uid=n,t.task.doing="0"},onSubmit:function(e){(function(t,e){return x("/index.php/task/comment",{method:"POST",body:"taskId="+encodeURIComponent(t)+"&comment="+encodeURIComponent(e)})})(t.task_id,e).then(function(n){if(n.error)throw Error(n.error);t.events.push({name:t.user.name,avatar:t.user.avatar,info:e,date:Date.now(),type:"comment"})}).catch(function(e){t.$message.error(e.message)})}}},methods:{handleOnDelete:function(){var t=this;this.$confirm("确认删除该任务？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){E(t.task_id).then(function(t){if(t.error)throw Error(t.error);we.go(-1)}).catch(function(e){t.$message.error(e.message)})}).catch(function(){})},recoverTask:function(){var t=this;(function(t){return x("/index.php/task/recover",{method:"POST",body:"taskId="+encodeURIComponent(t)})})(this.task_id).then(function(e){if(e.error)throw Error(e.error);t.task.deleted="0"}).catch(function(e){t.$message.error(e.message)})},editTask:function(){this.showEditTask=!0,this.form={name:this.task.name,description:this.task.description}},saveTask:function(){var t=this;this.$refs.form.validate(function(e){if(e){var n=t.form,i=n.name,a=n.description;(function(t,e,n){return x("/index.php/task/edit",{method:"POST",body:"taskId="+encodeURIComponent(t)+"&name="+encodeURIComponent(e)+"&description="+encodeURIComponent(n)})})(t.task_id,i,a).then(function(e){if(e.error)throw Error(e.error);t.task.name=i,t.task.description=a,t.showEditTask=!1}).catch(function(e){t.$message.error(e.message)})}})},getTaskInfo:function(){var t=this;(function(t){return x("/index.php/task/getInfo?taskId="+encodeURIComponent(t))})(this.task_id).then(function(e){if(e.error)throw Error(e.error);t.task=e.data.task,t.task.taskId=t.$route.params.task_id,t.events=e.data.events}).catch(function(e){t.$message.error(e.message)})}},computed:h()({task_id:function(){return this.$route.params.task_id},doingIcon:function(){return"1"===this.task.doing?"el-icon-loading":"el-icon-caret-right"},currentUserName:function(){if(null===this.task.uid)return"未分配";for(var t=this.members,e=0;e<t.length;++e)if(t[e].uid===this.task.uid)return t[e].name;return""}},Object(f.c)(["user"])),components:{EventPanel:Yt,Comment:Kt,Task:ct}},Qt={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticStyle:{position:"relative"}},["1"===t.task.deleted?n("div",{staticClass:"forbid-mask"},[n("el-button",{attrs:{type:"warning"},on:{click:t.recoverTask}},[t._v("该任务已被删除，点此恢复")])],1):t._e(),t._v(" "),null===t.task.archived?n("div",{staticClass:"task-info"},[n("task",{attrs:{task:t.task,members:t.members,onBeginTask:t.onBeginTask,onPauseTask:t.onPauseTask,onEditTask:t.onEditTask,onDeleteTask:t.onDeleteTask,onFinishTask:t.onFinishTask,onAllocatingTask:t.onAllocatingTask}}),t._v(" "),n("p",{staticClass:"tips task-desc"},[t._v(t._s(t.task.description))]),t._v(" "),null===t.task.finished&&null===t.task.archived?n("div",{staticStyle:{"margin-left":"25px","margin-top":"15px"}},[n("el-button",{attrs:{type:"primary",size:"mini",plain:""},on:{click:t.editTask}},[t._v("编辑")]),t._v(" "),n("el-button",{attrs:{type:"danger",size:"mini",plain:""},on:{click:t.handleOnDelete}},[t._v("删除")])],1):t._e(),t._v(" "),n("el-dialog",{attrs:{title:"编辑任务",visible:t.showEditTask},on:{"update:visible":function(e){t.showEditTask=e}}},[n("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules}},[n("el-form-item",{attrs:{prop:"name",label:"任务名","label-width":"100px"}},[n("el-input",{attrs:{"auto-complete":"off"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),t._v(" "),n("el-form-item",{attrs:{label:"任务描述","label-width":"100px"}},[n("el-input",{attrs:{"auto-complete":"off"},model:{value:t.form.description,callback:function(e){t.$set(t.form,"description",e)},expression:"form.description"}})],1)],1),t._v(" "),n("div",{attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(e){t.showEditTask=!1}}},[t._v("取 消")]),t._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:t.saveTask}},[t._v("确 定")])],1)],1)],1):n("div",{staticClass:"task-info"},[n("input",{attrs:{checked:"true",type:"checkbox",disabled:""}}),t._v(" "),n("span",{staticClass:"task-name",attrs:{type:"text"}},[t._v(t._s(t.task.name))]),t._v(" "),n("el-tag",{staticClass:"tag",attrs:{slot:"reference",size:"small",type:"info"},slot:"reference"},[t._v("\n      "+t._s(t.currentUserName)+"\n    ")])],1),t._v(" "),n("event-panel",{attrs:{table:"任务",events:t.events}}),t._v(" "),null===t.task.archived?n("comment",{attrs:{onSubmit:t.onSubmit}}):t._e()],1)},staticRenderFns:[]},Wt=n("VU/8")(Zt,Qt,!1,function(t){n("6EHV")},null,null).exports,Xt={name:"Discussion",created:function(){this.getDiscussionInfo()},data:function(){var t=this;return{discussion:{topic:"",description:"",date:"",name:"",avatar:""},events:[],showEditDiscussion:!1,form:{topic:"",description:""},rules:{topic:[{required:!0,message:"任务名不能为空",trigger:"blur"}]},onSubmit:function(e){(function(t,e){return x("/index.php/discussion/comment",{method:"POST",body:"did="+encodeURIComponent(t)+"&comment="+encodeURIComponent(e)})})(t.did,e).then(function(n){if(n.error)throw Error(n.error);t.events.push({name:t.user.name,avatar:t.user.avatar,type:"comment",date:Date.now(),info:e})}).catch(function(e){t.$message.error(e.message)})}}},computed:h()({},Object(f.c)(["user"]),{did:function(){return this.$route.params.did}}),methods:{handleOnDelete:function(){var t=this;this.$confirm("确认删除该讨论？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){(function(t){return x("/index.php/discussion/delete",{method:"POST",body:"did="+encodeURIComponent(t)})})(t.did).then(function(t){if(t.error)throw Error(t.error);we.go(-1)}).catch(function(e){t.$message.error(e.message)})}).catch(function(){})},recoverDiscussion:function(){var t=this;(function(t){return x("/index.php/discussion/recover",{method:"POST",body:"did="+encodeURIComponent(t)})})(this.did).then(function(e){if(e.error)throw Error(e.error);t.discussion.deleted="0"}).catch(function(e){t.$message.error(e.message)})},editDiscussion:function(){this.form={topic:this.discussion.topic,description:this.discussion.description},this.showEditDiscussion=!0},saveDiscussion:function(){var t=this;this.$refs.form.validate(function(e){if(e){var n=t.form,i=n.topic,a=n.description;(function(t,e,n){return x("/index.php/discussion/edit",{method:"POST",body:"did="+encodeURIComponent(t)+"&topic="+encodeURIComponent(e)+"&description="+encodeURIComponent(n)})})(t.did,i,a).then(function(e){if(e.error)throw Error(e.error);t.showEditDiscussion=!1,t.discussion.topic=i,t.discussion.description=a}).catch(function(e){t.$message.error(e.message)})}})},getDiscussionInfo:function(){var t=this;(function(t){return x("/index.php/discussion/getInfo?did="+encodeURIComponent(t))})(this.did).then(function(e){if(e.error)throw Error(e.error);t.discussion=e.data.discussion,t.events=e.data.events}).catch(function(e){t.$message.error(e.message)})}},components:{EventPanel:Yt,Comment:Kt}},te={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticStyle:{position:"relative"}},["1"===t.discussion.deleted?n("div",{staticClass:"forbid-mask"},[n("el-button",{attrs:{type:"warning"},on:{click:t.recoverDiscussion}},[t._v("该讨论已被删除，点此恢复")])],1):t._e(),t._v(" "),n("div",{staticClass:"discussion-header"},[n("h3",[t._v(t._s(t.discussion.topic))]),t._v(" "),n("div",{staticStyle:{float:"left",width:"60px"},attrs:{align:"center"}},[n("img",{staticClass:"avatar",staticStyle:{float:"none"},attrs:{width:"48",src:t.discussion.avatar,alt:"avatar"}})]),t._v(" "),n("div",{staticStyle:{"margin-left":"70px"}},[n("b",[t._v(t._s(t.discussion.name))]),t._v(" "),n("small",{staticClass:"tips"},[t._v(t._s(t.discussion.date))]),t._v(" "),n("p",{staticStyle:{}},[t._v(t._s(t.discussion.description))])]),t._v(" "),n("div",{staticStyle:{"margin-left":"70px","margin-top":"15px"}},[n("el-button",{attrs:{type:"primary",size:"mini",plain:""},on:{click:t.editDiscussion}},[t._v("编辑")]),t._v(" "),n("el-button",{attrs:{type:"danger",size:"mini",plain:""},on:{click:t.handleOnDelete}},[t._v("删除")])],1),t._v(" "),n("el-dialog",{attrs:{title:"编辑讨论",visible:t.showEditDiscussion},on:{"update:visible":function(e){t.showEditDiscussion=e}}},[n("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules}},[n("el-form-item",{attrs:{prop:"topic",label:"话题","label-width":"100px"}},[n("el-input",{attrs:{"auto-complete":"off"},model:{value:t.form.topic,callback:function(e){t.$set(t.form,"topic",e)},expression:"form.topic"}})],1),t._v(" "),n("el-form-item",{attrs:{label:"描述","label-width":"100px"}},[n("el-input",{attrs:{"auto-complete":"off"},model:{value:t.form.description,callback:function(e){t.$set(t.form,"description",e)},expression:"form.description"}})],1)],1),t._v(" "),n("div",{attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(e){t.showEditDiscussion=!1}}},[t._v("取 消")]),t._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:t.saveDiscussion}},[t._v("确 定")])],1)],1)],1),t._v(" "),n("event-panel",{attrs:{table:"讨论",events:t.events}}),t._v(" "),n("comment",{attrs:{onSubmit:t.onSubmit}})],1)},staticRenderFns:[]},ee=n("VU/8")(Xt,te,!1,function(t){n("UoGe")},null,null).exports,ne={name:"TaskList",props:["members"],data:function(){var t=this;return{taskList:{name:"loading",archived:null,deleted:"0"},tasks:[],events:[],onSubmit:function(e){(function(t,e){return x("/index.php/task/commentTaskList",{method:"POST",body:"taskListId="+encodeURIComponent(t)+"&comment="+encodeURIComponent(e)})})(t.taskListId,e).then(function(n){if(n.error)throw Error(n.error);t.events.push({name:t.user.name,avatar:t.user.avatar,type:"comment",date:Date.now(),info:e})}).catch(function(e){t.$message.error(e.message)})},onDeleteTask:function(e){var n=t.tasks.indexOf(e);t.tasks.splice(n,1)},onEditTask:function(e){var n=t.tasks.indexOf(e);t.$set(t.tasks,n,e)},onBeginTask:function(e){var n=t.tasks.indexOf(e);t.$set(t.tasks,n,e)},onPauseTask:function(e){var n=t.tasks.indexOf(e);t.$set(t.tasks,n,e)},onFinishTask:function(e){var n=t.tasks.indexOf(e);t.$set(t.tasks,n,e)},onAllocatingTask:function(e){var n=t.tasks.indexOf(e);t.$set(t.tasks,n,e)}}},created:function(){this.getTaskListInfo()},computed:h()({taskListId:function(){return this.$route.params.task_list_id}},Object(f.c)(["user"]),{progress:function(){return 0===this.tasks.length?0:this.tasks.filter(function(t){return null!==t.finished}).length/this.tasks.length*100}}),methods:{addTask:function(){var t=this;this.$prompt("请输入任务名","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/.+/,inputErrorMessage:"任务名不可为空"}).then(function(e){var n=e.value;S(t.$route.params.pid,n,t.taskListId).then(function(e){if(e.error)throw Error(e.error);t.tasks.push({taskId:e.data,uid:t.user.uid,name:n,taskListId:t.taskListId||null,doing:"0",finished:null})}).catch(function(e){t.$message.error(e.message)})}).catch(function(){})},handleOnDelete:function(){var t=this;this.$confirm("确认删除该任务清单？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){w(t.taskListId).then(function(t){if(t.error)throw Error(t.error);we.go(-1)}).catch(function(e){t.$message.error(e.message)})}).catch(function(){})},recoverTaskList:function(){var t=this;(function(t){return x("/index.php/task/recoverTaskList",{method:"POST",body:"taskListId="+encodeURIComponent(t)})})(this.taskListId).then(function(e){if(e.error)throw Error(e.error);t.taskList.deleted="0"}).catch(function(e){t.$message.error(e.message)})},archive:function(){var t=this;D(this.taskListId).then(function(e){if(e.error)throw Error(e.error);t.taskList.archived=Date.now()}).catch(function(e){t.$message.error(e.message)})},unArchive:function(){var t=this;(function(t){return x("/index.php/task/unArchivedTaskList",{method:"POST",body:"taskListId="+encodeURIComponent(t)})})(this.taskListId).then(function(e){if(e.error)throw Error(e.error);t.taskList.archived=null}).catch(function(e){t.$message.error(e.message)})},editTaskListName:function(){var t=this;this.$prompt("请输入新的任务清单名称","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputValue:this.taskList.name,inputPattern:/.+/,inputErrorMessage:"清单名称不能为空"}).then(function(e){var n=e.value;I(t.taskListId,n).then(function(e){if(e.error)throw Error(e.error);t.taskList.name=n}).catch(function(e){t.$message.error(e.message)})}).catch(function(){})},getTaskListInfo:function(){var t=this;(function(t){return x("/index.php/task/getTaskListInfo?taskListId="+encodeURIComponent(t))})(this.taskListId).then(function(e){if(e.error)throw Error(e.error);t.taskList=e.data.taskList,t.events=e.data.events,t.tasks=e.data.tasks}).catch(function(e){t.$message.error(e.message)})},allocatingUserName:function(t){if(null===t)return"未分配";for(var e=this.members,n=0;n<e.length;++n)if(e[n].uid===t)return e[n].name;return""}},components:{EventPanel:Yt,Comment:Kt,Task:ct}},ie={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticStyle:{position:"relative"}},["1"===t.taskList.deleted?n("div",{staticClass:"forbid-mask"},[n("el-button",{attrs:{type:"warning"},on:{click:t.recoverTaskList}},[t._v("该任务清单已被删除，点此恢复")])],1):t._e(),t._v(" "),n("div",{staticClass:"task-list-header"},[n("h3",[t._v(t._s(t.taskList.name))]),t._v(" "),null===t.taskList.archived?n("div",{staticStyle:{"margin-left":"15px"}},[n("el-button",{attrs:{type:"primary",size:"mini",plain:""},on:{click:t.editTaskListName}},[t._v("编辑")]),t._v(" "),n("el-button",{attrs:{type:"info",size:"mini",plain:""},on:{click:t.archive}},[t._v("归档")]),t._v(" "),n("el-button",{attrs:{type:"danger",size:"mini",plain:""},on:{click:t.handleOnDelete}},[t._v("删除")])],1):t._e()]),t._v(" "),n("el-progress",{attrs:{percentage:t.progress}}),t._v(" "),null===t.taskList.archived?n("div",{staticStyle:{"margin-bottom":"30px"}},[t._l(t.tasks,function(e){return n("task",{key:e.taskId,attrs:{task:e,members:t.members,onBeginTask:t.onBeginTask,onPauseTask:t.onPauseTask,onEditTask:t.onEditTask,onDeleteTask:t.onDeleteTask,onFinishTask:t.onFinishTask,onAllocatingTask:t.onAllocatingTask}})}),t._v(" "),n("el-button",{attrs:{type:"text"},on:{click:t.addTask}},[t._v("添加新任务")])],2):n("div",[t._l(t.tasks,function(e){return n("div",{key:e.taskId},[n("input",{attrs:{checked:"true",type:"checkbox",disabled:""}}),t._v(" "),n("router-link",{attrs:{to:{name:"TaskDetail",params:{task_id:e.taskId}}}},[n("el-button",{staticClass:"task-name",attrs:{type:"text"}},[t._v(t._s(e.name))])],1),t._v(" "),n("el-tag",{staticClass:"tag",attrs:{slot:"reference",size:"small",type:"info"},slot:"reference"},[t._v("\n        "+t._s(t.allocatingUserName(e.uid))+"\n      ")])],1)}),t._v("\n    任务清单已归档，需要编辑请\n    "),n("el-button",{attrs:{type:"text"},on:{click:t.unArchive}},[t._v("激活")])],2),t._v(" "),n("event-panel",{attrs:{table:"任务清单",events:t.events}}),t._v(" "),null===t.taskList.archived?n("comment",{attrs:{onSubmit:t.onSubmit}}):t._e()],1)},staticRenderFns:[]},ae=n("VU/8")(ne,ie,!1,function(t){n("3q6I")},null,null).exports,se={name:"ApplyTeam",mounted:function(){var t=this;(function(t){return x("/index.php/team/applyTeam?tid="+encodeURIComponent(t))})(this.$route.params.tid).then(function(e){if(e.error)throw Error(e.error);t.$message({message:"申请成功",type:"success"}),we.push({name:"Member",params:{tid:t.$route.params.tid}})}).catch(function(e){we.push({name:"Member",params:{tid:t.$route.params.tid}}),t.$message.error(e.message)})}},re={render:function(){var t=this.$createElement;return(this._self._c||t)("div")},staticRenderFns:[]},oe=n("VU/8")(se,re,!1,function(t){n("Y3R1")},null,null).exports,ce={name:"ProjectSettings",created:function(){this.getInfo()},data:function(){return{project:{name:"",description:"",isPrivate:"1"},form:{name:"",description:"",isPrivate:"1"},rules:{name:[{required:!0,message:"项目名不能为空",trigger:"blur"}]}}},computed:{hasChanged:function(){var t=this.form,e=t.name,n=t.description,i=t.isPrivate;return this.project.name!==e||this.project.description!==n||this.project.isPrivate!==i}},methods:{getInfo:function(){var t=this;(function(t){return x("/index.php/project/getSettingInfo?pid="+encodeURIComponent(t))})(this.$route.params.pid).then(function(e){if(e.error)throw Error(e.error);t.project=e.data,t.form={name:e.data.name,description:e.data.description,isPrivate:e.data.isPrivate}}).catch(function(e){t.$message.error(e.message)})},saveInfo:function(){var t=this,e=this.form,n=e.isPrivate,i=e.name,a=e.description;(function(t,e,n,i){return x("/index.php/project/saveSettingInfo",{method:"POST",body:"pid="+encodeURIComponent(t)+"&isPrivate="+encodeURIComponent(e)+"&name="+encodeURIComponent(n)+"&description="+encodeURIComponent(i)})})(this.$route.params.pid,n,i,a).then(function(e){if(e.error)throw Error(e.error);t.project.name=i,t.project.isPrivate=n,t.project.description=a,t.$message({message:"保存成功",type:"success"})}).catch(function(e){t.$message.error(e.message)})}}},le={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[t._m(0,!1,!1),t._v(" "),n("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules}},[n("el-form-item",{attrs:{prop:"name"}},[n("el-input",{attrs:{placeholder:"请输入项目名称..."},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),t._v(" "),n("el-form-item",{attrs:{prop:"description"}},[n("el-input",{attrs:{type:"textarea",placeholder:"请输入项目描述..."},model:{value:t.form.description,callback:function(e){t.$set(t.form,"description",e)},expression:"form.description"}})],1),t._v(" "),n("h3",[t._v("项目公开性")]),t._v(" "),n("el-radio-group",{model:{value:t.form.isPrivate,callback:function(e){t.$set(t.form,"isPrivate",e)},expression:"form.isPrivate"}},[n("el-radio",{staticClass:"radio",attrs:{label:"1"}},[n("b",{staticStyle:{"font-size":"1.2em"}},[t._v("私有项目")]),t._v(" "),n("p",{staticClass:"tips",staticStyle:{display:"inline"}},[t._v("仅项目成员可以查看和编辑该项目")])]),t._v(" "),n("br"),t._v(" "),n("el-radio",{staticClass:"radio",attrs:{label:"0"}},[n("b",{staticStyle:{"font-size":"1.2em"}},[t._v("公开项目")]),t._v(" "),n("p",{staticClass:"tips",staticStyle:{display:"inline"}},[t._v("任何人都可以通过链接查看该项目，仅项目成员可以编辑该项目")])])],1),t._v(" "),n("el-form-item",[n("el-button",{attrs:{type:"primary",disabled:!t.hasChanged},on:{click:t.saveInfo}},[t._v("保存设置")])],1)],1)],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticStyle:{"border-bottom":"1px solid #eee","padding-bottom":"20px","margin-bottom":"20px"}},[e("h2",{staticStyle:{margin:"0",display:"inline","margin-right":"10px"}},[this._v("项目设置")])])}]},de=n("VU/8")(ce,le,!1,function(t){n("/BnU")},null,null).exports,ue={name:"EditHistory",created:function(){this.getHistory()},data:function(){return{tableData:[]}},computed:{path:function(){var t=JSON.parse(K()(this.$route.params.path||[]));return t.push({name:"编辑历史",params:{name:this.$route.name,params:JSON.parse(K()(this.$route.params))}}),t}},methods:{getHistory:function(){var t=this;(function(t){return x("/index.php/document/getDocHistory?docId="+encodeURIComponent(t))})(this.$route.params.doc_id).then(function(e){if(e.error)throw Error(e.error);t.tableData=e.data,t.tableData.length>0&&(t.tableData[0].date+=" (当前版本)")}).catch(function(e){t.$message.error(e.message)})}}},me={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[t._m(0,!1,!1),t._v(" "),n("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData}},[n("el-table-column",{attrs:{prop:"date",label:"编辑时间"}}),t._v(" "),n("el-table-column",{attrs:{prop:"name",label:"用户"}}),t._v(" "),n("el-table-column",{attrs:{label:"操作",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("router-link",{attrs:{to:{name:"ViewDocument",params:{hid:e.row.hid,path:t.path}}}},[n("el-button",{attrs:{type:"text",size:"small"}},[t._v("查看")])],1)]}}])})],1)],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticStyle:{"border-bottom":"1px solid #eee","padding-bottom":"20px","margin-bottom":"20px"}},[e("h2",{staticStyle:{margin:"0",display:"inline","margin-right":"10px"}},[this._v("编辑历史")])])}]},pe=n("VU/8")(ue,me,!1,function(t){n("ve1F")},null,null).exports,he={name:"ViewDocument",created:function(){this.getContent()},data:function(){return{history:{date:"",content:"",doc_id:0}}},methods:{getContent:function(){var t=this;(function(t){return x("/index.php/document/getHistoryContent?hid="+encodeURIComponent(t))})(this.$route.params.hid).then(function(e){if(e.error)throw Error(e.error);t.history=e.data}).catch(function(e){t.$message.error(e.message)})}}},fe={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("p",{staticClass:"tips",staticStyle:{"margin-bottom":"20px"}},[this._v("编辑于 "+this._s(this.history.date))]),this._v(" "),e("mavon-editor",{attrs:{default_open:"preview",value:this.history.content,subfield:!1,toolbarsFlag:!1}})],1)},staticRenderFns:[]},ve=n("VU/8")(he,fe,!1,function(t){n("5t2J")},null,null).exports,ge={name:"Dynamic",created:function(){this.getTeamDynamic()},data:function(){return{events:{},dateSet:[]}},computed:{path:function(){var t=JSON.parse(K()(this.$route.params.path||[]));return t.push({name:"动态",params:{name:this.$route.name,params:JSON.parse(K()(this.$route.params))}}),t}},methods:{getTeamDynamic:function(){var t=this;this.events={},function(t){return x("/index.php/team/getDynamic?tid="+encodeURIComponent(t))}(this.$route.params.tid).then(function(e){if(e.error)throw Error(e.error);e.data.forEach(function(e){e.date=new Date(e.date);var n=t.getDate(e.date);void 0===t.events[n]?t.events[n]=[e]:t.events[n].push(e)}),t.dateSet=St()(t.events).sort(function(t,e){return t<e}),window.events=t.events[t.dateSet[0]],t.dateSet.forEach(function(e){t.events[e].sort(function(t,e){return t.date>e.date?1:-1})})}).catch(function(e){t.$message.error(e.message)})},getDate:function(t){return t.getFullYear()+"-"+this.addZero(t.getMonth()+1)+"-"+this.addZero(t.getDate())},addZero:function(t){return("00"+t).substr(-2)},getTime:function(t){return this.addZero(t.getHours())+":"+this.addZero(t.getMinutes())},getTableName:function(t){return"discussion"===t?"讨论":"task"===t?"任务":"任务清单"},getInfo:function(t,e){return e=this.getTableName(e),"create"===t?"创建了"+e:"finish"===t?"完成了"+e:"continue"===t?"继续执行"+e:"begin"===t?"开始执行"+e:"pause"===t?"暂停处理"+e:"reopen"===t?"恢复了"+e:"delete"===t?"删除了"+e:"archive"===t?"归档"+e:"active"===t?"激活"+e:"comment"===t?"回复了"+e:""},getRouterLink:function(t){return"任务"===t.table?{name:"TaskDetail",params:{pid:t.pid,task_id:t.id,path:this.path}}:"任务清单"===t.table?{name:"TaskListDetail",params:{pid:t.pid,task_list_id:t.id,path:this.path}}:{name:"DiscussionDetail",params:{pid:t.pid,did:t.id,path:this.path}}}},components:{Event:Event}},ke={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[t._m(0,!1,!1),t._v(" "),t._l(t.dateSet,function(e){return n("div",{key:e},[n("h3",[t._v(t._s(e))]),t._v(" "),t._l(t.events[e],function(e,i){return n("div",{key:i,staticClass:"dynamic-item"},[n("span",{staticClass:"dynamic-item-date"},[t._v(t._s(t.getTime(e.date)))]),t._v(" "),n("img",{staticClass:"avatar",attrs:{width:"48",height:"48",src:e.avatar,alt:"avatar"}}),t._v(" "),n("span",[n("router-link",{staticClass:"link",attrs:{to:{name:"UserInfo",params:{uid:e.uid,path:t.path}}}},[t._v("\n          "+t._s(e.name)+"\n        ")]),t._v("\n        "+t._s(t.getInfo(e.type,e.table))+"：\n        "),n("router-link",{staticClass:"link",attrs:{to:t.getRouterLink(e)}},[t._v(t._s(e.ename))]),t._v(" "),n("router-link",{attrs:{to:{name:"Project",params:{pid:e.pid,path:t.path}}}},[n("el-tag",{attrs:{type:"success"}},[t._v(t._s(e.pname))])],1)],1)])})],2)})],2)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticStyle:{"border-bottom":"1px solid #eee","padding-bottom":"20px","margin-bottom":"20px"}},[e("h2",{staticStyle:{margin:"0",display:"inline","margin-right":"10px"}},[this._v("团队动态")])])}]},_e=n("VU/8")(ge,ke,!1,function(t){n("WeDU")},null,null).exports,be=n("bOdI"),ye=n.n(be),Te=function(t,e){var n=t.commit;x("/index.php/user/get_info").then(function(t){t.error||n("LOGIN",t.data),e()}).catch(function(){})},xe=n("UjVw");s.default.use(f.a);var Ce=new f.a.Store({actions:i,getters:xe,state:{user:null},mutations:(a={},ye()(a,"LOGIN",function(t,e){t.user=e}),ye()(a,v,function(t){t.user=null}),ye()(a,g,function(t,e){t.user.avatar=e}),ye()(a,k,function(t,e){t.user.name=e.name,t.user.email=e.email}),a)});s.default.use(m.a);var $e=new m.a({routes:[{path:"/",name:"Login",component:R},{path:"/launchpad",name:"Launchpad",component:P},{path:"/team",redirect:"/launchpad"},{path:"/team/:tid",name:"Team",component:N,redirect:"/team/:tid/projects",children:[{path:"dynamic",name:"Dynamic",component:_e},{path:"projects",name:"Projects",component:J},{path:"member",name:"Member",component:et},{path:"userInfo/:uid/task/finished",name:"FinishedTasks",component:Lt},{path:"userInfo/:uid",name:"UserInfo",component:ut},{path:"task/:task_id",name:"TaskDetail",component:Wt},{path:"settings",name:"Settings",component:H},{path:"userSettings",name:"UserSettings",component:st},{path:"project/:pid/task/finished",name:"ProjectFinishedTasks",component:Bt},{path:"project/:pid/taskList/archived",name:"ArchivedTaskList",component:Vt},{path:"project/:pid/taskList/:task_list_id",name:"TaskListDetail",component:ae},{path:"project/:pid/discussion/:did",name:"DiscussionDetail",component:ee},{path:"project/:pid/settings",name:"ProjectSettings",component:de},{path:"project/:pid",name:"Project",component:It},{path:"fileBrowser/:dir_id",name:"FileBrowser",component:vt},{path:"documentBrowser/:doc_dir_id",name:"DocumentBrowser",component:Tt},{path:"document/:doc_id",name:"DocumentEditor",component:Ft},{path:"editHistory/:doc_id",name:"EditHistory",component:pe},{path:"viewDocument/:hid",name:"ViewDocument",component:ve},{path:"applyTeam",name:"ApplyTeam",component:oe}]}]});$e.beforeEach(function(t,e,n){null===Ce.state.user&&"Login"!==t.name?Ce.dispatch("getUserInfo",n):n()});var we=$e;s.default.use(o.a),s.default.use(l.a),s.default.config.productionTip=!1,new s.default({el:"#app",store:Ce,router:we,template:"<App/>",components:{App:u}})},UjVw:function(t,e){},UoGe:function(t,e){},Viya:function(t,e){},W2uI:function(t,e){},WeDU:function(t,e){},Y2Kz:function(t,e){},Y3R1:function(t,e){},Y5C0:function(t,e){},a6uz:function(t,e){},cOlY:function(t,e){},dt3N:function(t,e){},eQcR:function(t,e){},eTKJ:function(t,e){},"fp+U":function(t,e){},gTVl:function(t,e){},lPKG:function(t,e){},mGEc:function(t,e){},pw1w:function(t,e){},"qk+Y":function(t,e){},ve1F:function(t,e){},zCtl:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.e79a54c77b0198cddd6b.js.map